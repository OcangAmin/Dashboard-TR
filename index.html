<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuan Rumah Coffee - Integrated Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #1e293b; --accent: #4f46e5; }
        body { background-color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; }
        .ios-card { background: white; border-radius: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .ios-card:active { transform: scale(0.98); }
        .tab-active { border-bottom: 3px solid var(--accent); color: var(--accent); font-weight: bold; }
        input[type="number"] { width: 100%; border: 1px solid #e2e8f0; border-radius: 8px; padding: 4px 8px; font-weight: bold; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 bg-slate-900 text-white p-6 rounded-2xl shadow-xl">
            <div>
                <h1 class="text-3xl font-black tracking-tight">TUAN RUMAH COFFEE</h1>
                <p class="text-slate-400 text-sm">Dashboard Manajemen HPP Terintegrasi (2026 Edition)</p>
            </div>
            <div class="flex gap-4">
                <div class="text-center bg-slate-800 p-3 rounded-xl border border-slate-700">
                    <p class="text-[10px] uppercase text-slate-400 font-bold">Avg Margin</p>
                    <p id="total-margin-display" class="text-2xl font-black text-emerald-400">0%</p>
                </div>
            </div>
        </header>

        <section class="ios-card p-6 mb-8 border-l-8 border-indigo-600">
            <h2 class="font-black text-lg mb-4 text-slate-800 uppercase">âš¡ Database 4: Espresso Parameter (Sync)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="text-xs font-bold text-slate-500">KAKS DOSAGE (gr)</label>
                    <input type="number" id="es-kaks-dose" value="18" onchange="syncSistem()">
                    <p class="text-[10px] text-slate-400 mt-1">Standard: 18gr â†’ 60ml</p>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500">DIKS DOSAGE (gr)</label>
                    <input type="number" id="es-diks-dose" value="18" onchange="syncSistem()">
                    <p class="text-[10px] text-slate-400 mt-1">Standard: 18gr â†’ 36ml</p>
                </div>
                <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                    <label class="text-xs font-bold text-indigo-600">KOPI SUSU (Special)</label>
                    <p class="text-xl font-black">18gr : 35ml</p>
                    <p class="text-[10px] text-indigo-400">HPP Terkunci Khusus Menu Kopi Susu</p>
                </div>
            </div>
        </section>

        <div class="flex gap-6 border-b mb-6 overflow-x-auto pb-2 no-scrollbar">
            <button onclick="switchTab('db1')" id="tab-db1" class="tab-active py-2 px-4 whitespace-nowrap">Bahan Baku (DB1)</button>
            <button onclick="switchTab('db3')" id="tab-db3" class="py-2 px-4 whitespace-nowrap text-slate-400">Menu & Resep (DB2/3)</button>
            <button onclick="switchTab('insight')" id="tab-insight" class="py-2 px-4 whitespace-nowrap text-slate-400">AI Insight & Dashboard</button>
        </div>

        <div id="db1" class="tab-content">
            <div class="ios-card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50 text-slate-600 uppercase text-[10px] font-bold">
                                <th class="p-4 border-b">Bahan</th>
                                <th class="p-4 border-b">Brand</th>
                                <th class="p-4 border-b">Harga Beli</th>
                                <th class="p-4 border-b">Isi</th>
                                <th class="p-4 border-b">Harga/Unit</th>
                                <th class="p-4 border-b">Link</th>
                            </tr>
                        </thead>
                        <tbody id="raw-material-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="db3" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="menu-grid"></div>
        </div>

        <div id="insight" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="ios-card p-6 bg-indigo-900 text-white">
                    <h3 class="font-bold text-xl mb-4">âœ¨ AI Business Insight</h3>
                    <div id="ai-insight-content" class="space-y-4 text-slate-200 text-sm"></div>
                </div>
                <div class="ios-card p-6 border border-slate-200">
                    <h3 class="font-bold text-xl mb-4">Overhead Bulanan</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between"><span>Listrik</span><span class="font-bold">Rp 6.000.000</span></div>
                        <div class="flex justify-between"><span>Gaji Karyawan (8 Orang)</span><span class="font-bold">Rp 12.000.000</span></div>
                        <div class="pt-3 border-t font-black text-red-600 flex justify-between"><span>Total/Hari</span><span>Rp 600.000</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATA FINAL WAJIB (DATABASE 1)
        const dbBahan = {
            "Kopi Toraja": { brand: "Kaks", cat: "Kopi", unit: "gr", beli: 230000, isi: 1000, link: "tokopedia.com/kaks" },
            "Kopi Sumatra": { brand: "Diks", cat: "Kopi", unit: "gr", beli: 280000, isi: 1000, link: "tokopedia.com/diks" },
            "Monin Caramel": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "Monin Vanilla": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "Monin Tiramisu": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "Monin Banana": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "Monin Butterscotch": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "Monin Pandan": { brand: "Monin", cat: "Syrup", unit: "ml", beli: 165000, isi: 700, link: "shopee.com/monin" },
            "UHT Diamond": { brand: "Diamond", cat: "Dairy", unit: "ml", beli: 215000, isi: 12000, link: "shopee.com/diamond" },
            "Evaporasi": { brand: "Diamond", cat: "Dairy", unit: "ml", beli: 18000, isi: 380, link: "shopee.com" },
            "SKM": { brand: "Omela", cat: "Dairy", unit: "ml", beli: 13000, isi: 370, link: "shopee.com" },
            "Creamer": { brand: "MaxCreamer", cat: "Powder", unit: "gr", beli: 35000, isi: 500, link: "tokopedia.com" },
            "Cheese Cream": { brand: "Anchor", cat: "Dairy", unit: "ml", beli: 75000, isi: 500, link: "shopee.com" },
            "Aren": { brand: "Dainchi", cat: "Lain-lain", unit: "gr", beli: 45000, isi: 1000, link: "tokopedia.com" },
            "Skippy": { brand: "Skippy", cat: "Lain-lain", unit: "gr", beli: 65000, isi: 500, link: "shopee.com" },
            "Es Batu": { brand: "Internal", cat: "Operasional", unit: "gr", beli: 70000, isi: 8000, link: "internal" },
            "Packaging Ice": { brand: "Gen", cat: "Operasional", unit: "pcs", beli: 1050, isi: 1, link: "internal" }, // Cup+Lid+Straw
            "Packaging Hot": { brand: "Gen", cat: "Operasional", unit: "pcs", beli: 900, isi: 1, link: "internal" }
        };

        // DATA MENU & RESEP (DATABASE 2 & 3)
        const dbMenu = [
            { name: "Kopi Susu", cat: "Coffee Based", type: "Ice", price: 23000, recipe: { "SKM": 20, "Creamer": 15, "Evaporasi": 10, "Kopi Toraja": 18, "UHT Diamond": 70 }, isSpecial: true },
            { name: "Tuan Rumah", cat: "Coffee Based", type: "Ice", price: 25000, recipe: { "Aren": 25, "Creamer": 25, "Kopi Toraja": 18, "UHT Diamond": 100 } },
            { name: "Tiramisu", cat: "Coffee Based", type: "Ice", price: 28000, recipe: { "Monin Tiramisu": 20, "SKM": 10, "Creamer": 15, "Kopi Toraja": 18, "UHT Diamond": 100, "Cheese Cream": 20 } },
            { name: "Peanut Butter", cat: "Coffee Based", type: "Ice", price: 28000, recipe: { "Skippy": 15, "SKM": 10, "Monin Caramel": 10, "Creamer": 10, "Kopi Toraja": 18, "UHT Diamond": 100 } }
        ];

        function syncSistem() {
            renderBahan();
            renderMenu();
        }

        function renderBahan() {
            const body = document.getElementById('raw-material-body');
            body.innerHTML = '';
            for (let name in dbBahan) {
                const b = dbBahan[name];
                const unitPrice = b.beli / b.isi;
                body.innerHTML += `
                    <tr class="text-sm border-b">
                        <td class="p-4 font-bold text-slate-800">${name}</td>
                        <td class="p-4">${b.brand}</td>
                        <td class="p-4"><input type="number" value="${b.beli}" onchange="dbBahan['${name}'].beli=this.value; syncSistem()"></td>
                        <td class="p-4 text-xs">${b.isi} ${b.unit}</td>
                        <td class="p-4 font-black text-indigo-600">Rp ${unitPrice.toFixed(2)}</td>
                        <td class="p-4"><a href="https://${b.link}" target="_blank" class="text-xs text-blue-500 underline uppercase font-bold">Ref</a></td>
                    </tr>`;
            }
        }

        function renderMenu() {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            let totalProfit = 0;
            let totalMargin = 0;

            dbMenu.forEach(m => {
                let hpp = 0;
                for (let item in m.recipe) {
                    const cost = (dbBahan[item].beli / dbBahan[item].isi) * m.recipe[item];
                    hpp += cost;
                }
                
                // Add Packaging & Ice
                if (m.type === "Ice") {
                    hpp += (dbBahan["Es Batu"].beli / dbBahan["Es Batu"].isi) * 100;
                    hpp += dbBahan["Packaging Ice"].beli;
                } else {
                    hpp += dbBahan["Packaging Hot"].beli;
                }

                const profit = m.price - hpp;
                const margin = (profit / m.price) * 100;
                totalMargin += margin;

                grid.innerHTML += `
                    <div class="ios-card p-5 border-t-4 ${margin < 60 ? 'border-red-500' : 'border-emerald-500'}">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${m.cat}</p>
                                <h3 class="font-black text-lg text-slate-800">${m.name}</h3>
                            </div>
                            <span class="bg-slate-100 text-[10px] font-black px-2 py-1 rounded-full uppercase">${m.type}</span>
                        </div>
                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-xs text-slate-500">HPP: <span class="font-bold">Rp ${Math.round(hpp).toLocaleString()}</span></p>
                                <p class="text-lg font-black text-indigo-600">Rp ${m.price.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] font-bold text-slate-400">MARGIN</p>
                                <p class="text-xl font-black ${margin < 60 ? 'text-red-500' : 'text-emerald-500'}">${margin.toFixed(1)}%</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-slate-50">
                            <p class="text-[10px] font-bold text-slate-400">REC. HARGA (70% MARGIN)</p>
                            <p class="font-bold text-slate-600 text-sm">Rp ${Math.round((hpp / 0.3) / 1000) * 1000}</p>
                        </div>
                    </div>`;
            });
            document.getElementById('total-margin-display').innerText = (totalMargin / dbMenu.length).toFixed(1) + "%";
            renderAI(totalMargin / dbMenu.length);
        }

        function renderAI(avgMargin) {
            const ai = document.getElementById('ai-insight-content');
            ai.innerHTML = `
                <div class="p-3 bg-white/10 rounded-lg">
                    <p class="font-bold mb-1">ðŸ“¢ Analisa Margin</p>
                    <p>Rata-rata margin Anda <b>${avgMargin.toFixed(1)}%</b>. Ini ${avgMargin > 60 ? 'Sangat Sehat' : 'Perlu Peninjauan Harga Jual'}.</p>
                </div>
                <div class="p-3 bg-white/10 rounded-lg">
                    <p class="font-bold mb-1">ðŸ“¢ Efisiensi Operasional</p>
                    <p>Overhead Rp 600.000/hari mengharuskan Anda menjual minimal 40 cup Tuan Rumah per hari untuk Break Even Point (BEP).</p>
                </div>`;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('tab-active', 'text-slate-800'));
            document.getElementById(tabId).classList.remove('hidden');
            document.getElementById('tab-' + tabId).classList.add('tab-active');
        }

        syncSistem();
    </script>
</body>
</html>
