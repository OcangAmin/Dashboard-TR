<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuan Rumah OS - Management Coffee Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F2F2F7; padding-bottom: 100px; }
        .ios-blur { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .ios-card { border-radius: 20px; background: white; border: 1px solid rgba(0,0,0,0.05); }
        .ios-input { background: #F2F2F7; border: none; border-radius: 10px; padding: 8px 12px; font-weight: 600; outline: none; transition: 0.2s; }
        .ios-input:focus { background: #E5E5EA; box-shadow: 0 0 0 2px #007AFF; }
        [x-cloak] { display: none !important; }
        
        .cat-kopi { background: #5D4037; color: white; }
        .cat-syrup { background: #D81B60; color: white; }
        .cat-dairy { background: #007AFF; color: white; }
        .cat-powder { background: #8E44AD; color: white; }
        .cat-tea { background: #27AE60; color: white; }
        .cat-ops { background: #455A64; color: white; }
    </style>
</head>
<body x-data="coffeeApp()" x-init="init()" class="text-slate-900">

    <nav class="fixed bottom-0 left-0 right-0 bg-white/80 border-t border-gray-200 ios-blur flex justify-around items-center py-4 z-50">
        <template x-for="tab in tabs" :key="tab.id">
            <button @click="activeTab = tab.id" 
                    :class="activeTab === tab.id ? 'text-blue-600' : 'text-gray-400'"
                    class="flex flex-col items-center transition-all duration-300">
                <span class="text-2xl" x-text="tab.icon"></span>
                <span class="text-[9px] font-bold uppercase mt-1" x-text="tab.name"></span>
            </button>
        </template>
    </nav>

    <header class="p-6 pt-10 sticky top-0 bg-[#F2F2F7]/90 ios-blur z-40">
        <div class="max-w-6xl mx-auto flex justify-between items-end">
            <div>
                <h1 class="text-2xl font-black tracking-tighter">TUAN RUMAH OS</h1>
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" x-text="tabs.find(t => t.id === activeTab).fullName"></p>
            </div>
            <div class="text-right">
                <p class="text-[9px] font-bold text-blue-600 uppercase">Est. Net Profit Dec</p>
                <p class="text-xl font-black" x-text="'Rp' + formatNumber(calculateNetProfit())"></p>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6">

        <section x-show="activeTab === 'dashboard'" x-cloak class="space-y-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="ios-card p-4">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Total Revenue</p>
                    <p class="text-lg font-black text-slate-800" x-text="'Rp' + formatNumber(revenue)"></p>
                </div>
                <div class="ios-card p-4">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Avg Margin</p>
                    <p class="text-lg font-black text-green-600" x-text="calculateAvgMargin() + '%'"></p>
                </div>
                <div class="ios-card p-4">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Total HPP (Est)</p>
                    <p class="text-lg font-black text-red-500" x-text="'Rp' + formatNumber(totalHPPVal)"></p>
                </div>
                <div class="ios-card p-4">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Overhead</p>
                    <p class="text-lg font-black text-orange-500" x-text="'Rp' + formatNumber(calculateOverhead())"></p>
                </div>
            </div>

            <div class="bg-slate-900 ios-card p-6 text-white relative overflow-hidden">
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-blue-500 p-1 rounded text-xs italic font-bold text-white">AI INSIGHT</span>
                    <h3 class="text-lg font-bold">Analisa Bisnis Global</h3>
                </div>
                <div class="space-y-3 text-sm text-slate-300">
                    <p x-text="getGlobalInsight()"></p>
                    <p class="text-xs text-slate-500 border-t border-white/10 pt-2 italic">
                        *Berdasarkan perbandingan Revenue Rp103M vs Overhead & HPP.
                    </p>
                </div>
            </div>
        </section>

        <section x-show="activeTab === 'bahan'" x-cloak class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <template x-for="(b, idx) in bahanBaku" :key="idx">
                    <div class="ios-card p-4">
                        <div class="flex justify-between items-start mb-2">
                            <span :class="getCatStyle(b.kategori)" class="px-2 py-1 rounded text-[8px] font-black uppercase" x-text="b.kategori"></span>
                            <span class="text-[10px] text-gray-400 font-bold" x-text="b.brand"></span>
                        </div>
                        <h4 class="font-bold text-sm mb-2" x-text="b.nama"></h4>
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div>
                                <label class="text-[8px] font-bold text-gray-400 block">TOTAL HARGA</label>
                                <input type="number" x-model.number="b.hargaBeliTotal" class="ios-input w-full text-xs">
                            </div>
                            <div>
                                <label class="text-[8px] font-bold text-gray-400 block">ISI (<span x-text="b.satuan"></span>)</label>
                                <input type="number" x-model.number="b.isi" class="ios-input w-full text-xs">
                            </div>
                        </div>
                        <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg">
                            <span class="text-[9px] font-bold text-gray-400">HARGA PER <span x-text="b.satuan.toUpperCase()"></span></span>
                            <span class="text-xs font-black text-blue-600" x-text="'Rp' + formatNumber(b.hargaBeliTotal / b.isi)"></span>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <section x-show="activeTab === 'finance'" x-cloak class="space-y-6">
            <div class="ios-card p-6 bg-white">
                <h3 class="font-black text-lg mb-4">Input Pengeluaran Devisi</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Operasional Bar (Bahan & Maintenance)</label>
                            <input type="number" x-model.number="devExpense.bar" class="ios-input w-full mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Operasional Dapur</label>
                            <input type="number" x-model.number="devExpense.dapur" class="ios-input w-full mt-1">
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Gaji Karyawan (8 Orang)</label>
                            <input type="number" x-model.number="overhead.gaji" class="ios-input w-full mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Listrik & Air</label>
                            <input type="number" x-model.number="overhead.utilitas" class="ios-input w-full mt-1">
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        function coffeeApp() {
            return {
                activeTab: 'dashboard',
                revenue: 103811000,
                totalHPPVal: 0,
                tabs: [
                    { id: 'dashboard', name: 'Analisa', icon: 'ðŸ“Š', fullName: 'Global Dashboard & AI Insight' },
                    { id: 'bahan', name: 'Bahan', icon: 'ðŸ“¦', fullName: 'Database Bahan Baku' },
                    { id: 'resep', name: 'Resep', icon: 'ðŸ§¾', fullName: 'Junction Recipe Data' },
                    { id: 'menu', name: 'Menu', icon: 'â˜•', fullName: 'Menu Profitability' },
                    { id: 'finance', name: 'Finance', icon: 'ðŸ’°', fullName: 'Income & Expense Tracking' }
                ],
                
                // DATA BAHAN BAKU (Sesuai Data Anda)
                bahanBaku: [
                    { nama: 'Arabika Grade 1 Kaks', kategori: 'Kopi', brand: 'Local', satuan: 'gr', hargaBeliTotal: 240000, isi: 1000 },
                    { nama: 'Arabika Specialty Diks', kategori: 'Kopi', brand: 'Local', satuan: 'gr', hargaBeliTotal: 280000, isi: 1000 },
                    { nama: 'Monin Caramel', kategori: 'Syrup', brand: 'Monin', satuan: 'ml', hargaBeliTotal: 175000, isi: 700 },
                    { nama: 'Susu UHT Diamond', kategori: 'Dairy', brand: 'Diamond', satuan: 'ml', hargaBeliTotal: 21000, isi: 1000 },
                    { nama: 'Oatside', kategori: 'Dairy', brand: 'Oatside', satuan: 'ml', hargaBeliTotal: 42000, isi: 1000 },
                    { nama: 'Bubuk Matcha', kategori: 'Powder', brand: 'Premium', satuan: 'gr', hargaBeliTotal: 125000, isi: 1000 },
                    { nama: 'Cup Ice 16oz', kategori: 'Operasional', brand: 'Generic', satuan: 'pcs', hargaBeliTotal: 45000, isi: 50 },
                    { nama: 'Es Batu', kategori: 'Operasional', brand: 'Ice', satuan: 'gr', hargaBeliTotal: 70000, isi: 8000 }
                ],

                // DEVISI & OVERHEAD
                overhead: { gaji: 12000000, utilitas: 6000000 },
                devExpense: { bar: 2000000, dapur: 1500000 },

                init() {
                    this.totalHPPVal = this.revenue * 0.35; // Dummy awal sebelum hitung resep detail
                },

                calculateOverhead() {
                    return this.overhead.gaji + this.overhead.utilitas + this.devExpense.bar + this.devExpense.dapur;
                },

                calculateNetProfit() {
                    return this.revenue - this.totalHPPVal - this.calculateOverhead();
                },

                calculateAvgMargin() {
                    return Math.round(((this.revenue - this.totalHPPVal) / this.revenue) * 100);
                },

                getGlobalInsight() {
                    const margin = this.calculateAvgMargin();
                    if(margin < 40) return "Kritikal: Margin kotor di bawah 40%. Segera audit komposisi resep dan kurangi food waste di bar.";
                    if(margin >= 60) return "Sangat Sehat: Margin tinggi ditemukan. Fokus pada peningkatan volume penjualan melalui promo bundling.";
                    return "Stabil: Performa menu berada pada rentang industri yang sehat (50-60%).";
                },

                formatNumber(num) {
                    return new Intl.NumberFormat('id-ID').format(Math.round(num));
                },

                getCatStyle(cat) {
                    const maps = { 'Kopi': 'cat-kopi', 'Syrup': 'cat-syrup', 'Dairy': 'cat-dairy', 'Powder': 'cat-powder' };
                    return maps[cat] || 'cat-ops';
                }
            }
        }
    </script>
</body>
</html>
