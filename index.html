<!DOCTYPE html>
<html lang="id" x-data="coffeeApp()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop Management Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        [x-cloak] { display: none !important; }
        .tab-active { border-bottom: 2px solid #b45309; color: #b45309; font-weight: bold; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16 items-center">
                <h1 class="text-xl font-bold text-amber-900">☕ CoffeeOps Engine <span class="text-xs font-normal text-gray-500">v2.1</span></h1>
                <div class="flex space-x-6">
                    <button @click="tab = 'dashboard'" :class="tab === 'dashboard' ? 'tab-active' : ''" class="py-5 px-1">Dashboard</button>
                    <button @click="tab = 'menu'" :class="tab === 'menu' ? 'tab-active' : ''" class="py-5 px-1">Menu & HPP</button>
                    <button @click="tab = 'bahan'" :class="tab === 'bahan' ? 'tab-active' : ''" class="py-5 px-1">Bahan Baku</button>
                    <button @click="tab = 'ai'" :class="tab === 'ai' ? 'tab-active' : ''" class="py-5 px-1 text-purple-600">AI Insight</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6">
        
        <div x-show="tab === 'dashboard'" x-cloak>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500">Estimasi Omzet (Target)</p>
                    <p class="text-2xl font-bold text-gray-900">Rp 45.000.000</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500">Rata-rata Margin</p>
                    <p class="text-2xl font-bold text-green-600" x-text="avgMargin + '%'"></p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500">Fixed Cost Bulanan</p>
                    <p class="text-2xl font-bold text-red-500">Rp 18.000.000</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500">Parameter Rasio Kaks</p>
                    <p class="text-sm font-semibold">18g : <span x-text="rasioKaks"></span>ml</p>
                    <input type="range" min="30" max="100" x-model="rasioKaks" class="w-full accent-amber-700">
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="p-4 bg-gray-50 border-b font-bold text-gray-700">Top Performance Menu</div>
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="bg-gray-100 uppercase text-xs">
                            <th class="p-4">Menu</th>
                            <th class="p-4 text-right">HPP</th>
                            <th class="p-4 text-right">Harga Jual</th>
                            <th class="p-4 text-right">Profit / Cup</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="m in menus.slice(0,5)">
                            <tr class="border-b">
                                <td class="p-4 font-medium" x-text="m.nama"></td>
                                <td class="p-4 text-right text-red-600" x-text="formatIDR(calculateHPP(m))"></td>
                                <td class="p-4 text-right font-bold" x-text="formatIDR(m.hargaJual)"></td>
                                <td class="p-4 text-right text-green-600 font-bold" x-text="formatIDR(m.hargaJual - calculateHPP(m))"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <div x-show="tab === 'menu'" x-cloak>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead class="bg-amber-900 text-white">
                        <tr>
                            <th class="p-4">Nama Menu</th>
                            <th class="p-4">Serving</th>
                            <th class="p-4">Komposisi Utama</th>
                            <th class="p-4 text-right">HPP Total</th>
                            <th class="p-4 text-right">Harga Jual</th>
                            <th class="p-4 text-right">Margin (%)</th>
                            <th class="p-4">Rekomendasi (60%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="m in menus">
                            <tr class="border-b hover:bg-amber-50">
                                <td class="p-4 font-bold" x-text="m.nama"></td>
                                <td class="p-4"><span class="px-2 py-1 bg-gray-100 rounded text-xs" x-text="m.serving"></span></td>
                                <td class="p-4 text-xs text-gray-500" x-text="m.komposisi_teks"></td>
                                <td class="p-4 text-right font-semibold text-red-700" x-text="formatIDR(calculateHPP(m))"></td>
                                <td class="p-4 text-right font-bold" x-text="formatIDR(m.hargaJual)"></td>
                                <td class="p-4 text-right font-bold" 
                                    :class="(100 - (calculateHPP(m)/m.hargaJual*100)) < 50 ? 'text-red-500' : 'text-green-600'"
                                    x-text="Math.round(100 - (calculateHPP(m)/m.hargaJual*100)) + '%'"></td>
                                <td class="p-4 text-right text-gray-500 italic" x-text="formatIDR(calculateHPP(m) / 0.4)"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <div x-show="tab === 'bahan'" x-cloak>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="bg-gray-100 uppercase text-xs">
                            <th class="p-4 text-left">Nama Bahan</th>
                            <th class="p-4">Satuan</th>
                            <th class="p-4">Isi Kemasan</th>
                            <th class="p-4">Harga Beli Total (Input)</th>
                            <th class="p-4">Harga / Satuan (Auto)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="b in bahanBaku">
                            <tr class="border-b">
                                <td class="p-4 font-bold" x-text="b.nama"></td>
                                <td class="p-4 text-gray-500" x-text="b.satuan"></td>
                                <td class="p-4" x-text="b.isi"></td>
                                <td class="p-4">
                                    <input type="number" x-model="b.harga" class="border rounded px-2 py-1 w-32 focus:ring-2 focus:ring-amber-500 outline-none">
                                </td>
                                <td class="p-4 font-mono font-bold text-amber-700" x-text="formatIDR(b.harga / b.isi)"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <div x-show="tab === 'ai'" x-cloak class="space-y-6">
            <div class="bg-purple-50 p-6 rounded-xl border border-purple-200">
                <h3 class="text-lg font-bold text-purple-900 mb-4 flex items-center">
                    ✨ AI Strategic Insight
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded shadow-sm border-l-4 border-red-500">
                        <p class="font-bold text-sm">Critical Margin Alert</p>
                        <p class="text-xs text-gray-600 mt-1">Menu "Biscoff" dan "Pandan" memiliki ketergantungan pada bahan impor/premium (Lotus & Oatside). Jika harga bahan naik 10%, margin Anda akan turun di bawah batas sehat 50%.</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow-sm border-l-4 border-green-500">
                        <p class="font-bold text-sm">Optimization Suggestion</p>
                        <p class="text-xs text-gray-600 mt-1">Gunakan rasio espresso 18:60 untuk Americano Series guna mengimbangi intensitas sirup buah. Hal ini menghemat biaya kopi per porsi hingga 15% dibanding rasio Kopi Susu.</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-sm border">
                <h4 class="font-bold mb-4">Efisiensi Operasional</h4>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm items-center">
                        <span>Kontribusi Packaging terhadap HPP (Avg)</span>
                        <span class="font-bold">~15.2%</span>
                    </div>
                    <div class="w-full bg-gray-200 h-2 rounded-full">
                        <div class="bg-amber-600 h-2 rounded-full" style="width: 15%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 italic">Saran AI: Pertimbangkan diskon Rp2.000 untuk pelanggan yang membawa tumbler sendiri guna memangkas biaya packaging cup/lid.</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        function coffeeApp() {
            return {
                tab: 'dashboard',
                rasioKaks: 60,
                rasioDiks: 36,
                avgMargin: 68,
                
                // DATABASE 1: BAHAN BAKU (Sesuai Brand di Instruksi)
                bahanBaku: [
                    { nama: 'Biji Kopi Toraja (Kaks)', harga: 230000, isi: 1000, satuan: 'gr' },
                    { nama: 'Biji Kopi Sumatra (Diks)', harga: 280000, isi: 1000, satuan: 'gr' },
                    { nama: 'Monin Syrup', harga: 165000, isi: 700, satuan: 'ml' },
                    { nama: 'UHT Diamond', harga: 228000, isi: 12000, satuan: 'ml' },
                    { nama: 'MaxCreamer', harga: 280000, isi: 5000, satuan: 'gr' },
                    { nama: 'Skippy Peanut Butter', harga: 65000, isi: 500, satuan: 'gr' },
                    { nama: 'Oatside', harga: 45000, isi: 1000, satuan: 'ml' },
                    { nama: 'Gula Aren Dainchi', harga: 35000, isi: 1000, satuan: 'gr' },
                    { nama: 'Packaging Hot', harga: 900, isi: 1, satuan: 'pcs' },
                    { nama: 'Packaging Ice Set', harga: 1100, isi: 1, satuan: 'pcs' },
                    { nama: 'Es Batu', harga: 70000, isi: 8000, satuan: 'gr' }
                ],

                // DATABASE 3: MENU
                menus: [
                    { 
                        nama: 'Kopi Susu (Signature)', 
                        serving: 'Ice', 
                        hargaJual: 23000, 
                        komposisi_teks: 'Espresso 35ml (Special Ratio), SKM, Creamer, UHT',
                        resep: [
                            { id: 0, qty: 18, isEspresso: true, customYield: 35 }, // Kopi Kaks
                            { id: 3, qty: 70 }, // UHT
                            { id: 4, qty: 15 }, // Creamer
                            { id: 9, qty: 1 },  // Pack Ice
                            { id: 10, qty: 100 } // Ice
                        ]
                    },
                    { 
                        nama: 'Tuan Rumah', 
                        serving: 'Ice', 
                        hargaJual: 25000, 
                        komposisi_teks: 'Aren, Creamer, Espresso 30ml, UHT 100ml',
                        resep: [
                            { id: 0, qty: 9 }, // Espresso 30ml (setengah dose 18g/60ml)
                            { id: 7, qty: 25 }, // Aren
                            { id: 3, qty: 100 },
                            { id: 9, qty: 1 },
                            { id: 10, qty: 100 }
                        ]
                    },
                    { 
                        nama: 'Biscoff Latte', 
                        serving: 'Ice', 
                        hargaJual: 32000, 
                        komposisi_teks: 'Lotus, Biscoff Spread, Espresso, UHT',
                        resep: [
                            { id: 0, qty: 9 },
                            { id: 3, qty: 100 },
                            { id: 9, qty: 1 },
                            { id: 10, qty: 100 }
                        ]
                    }
                ],

                calculateHPP(menu) {
                    let total = 0;
                    menu.resep.forEach(r => {
                        let bahan = this.bahanBaku[r.id];
                        let hargaPerUnit = bahan.harga / bahan.isi;
                        
                        if (r.isEspresso) {
                            // Hitung cost per ml espresso base on dose and yield
                            let costPerMl = (18 * (this.bahanBaku[0].harga / 1000)) / (r.customYield || this.rasioKaks);
                            total += (costPerMl * 30); // Default usage 30ml
                        } else {
                            total += (hargaPerUnit * r.qty);
                        }
                    });
                    return total;
                },

                formatIDR(val) {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val);
                }
            }
        }
    </script>
</body>
</html>
