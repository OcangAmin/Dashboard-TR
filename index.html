<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Management OS - iOS Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F2F2F7; }
        .ios-blur { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .ios-card { border-radius: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .ios-card:active { transform: scale(0.98); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="text-slate-900" x-data="coffeeApp()" x-init="init()">

    <div class="flex h-screen overflow-hidden">
        <aside class="w-72 bg-white/80 border-r border-gray-200 ios-blur flex flex-col hidden md:flex">
            <div class="p-8">
                <div class="w-12 h-12 bg-black rounded-2xl flex items-center justify-center mb-4 shadow-xl">
                    <span class="text-2xl">â˜•</span>
                </div>
                <h1 class="text-xl font-extrabold tracking-tight">Tuan Rumah</h1>
                <p class="text-xs text-gray-400 font-medium uppercase tracking-widest">Coffee System v2.0</p>
            </div>
            
            <nav class="flex-1 px-4 space-y-1">
                <template x-for="tab in tabs" :key="tab.id">
                    <button @click="activeTab = tab.id" 
                            :class="activeTab === tab.id ? 'bg-blue-50 text-blue-600' : 'text-slate-500 hover:bg-gray-50'"
                            class="w-full flex items-center gap-3 px-4 py-3 rounded-2xl text-sm font-semibold transition-all">
                        <span class="text-lg" x-text="tab.icon"></span>
                        <span x-text="tab.name"></span>
                    </button>
                </template>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto relative pb-20">
            <header class="sticky top-0 z-30 bg-white/70 ios-blur border-b border-gray-100 p-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold tracking-tight" x-text="tabs.find(t => t.id === activeTab).name"></h2>
                <div class="flex items-center gap-3">
                    <div class="bg-gray-100 px-4 py-2 rounded-full text-[10px] font-bold text-gray-500 uppercase tracking-tighter">
                        Espresso Control: <span class="text-blue-600" x-text="'Rp ' + formatNumber(espressoPrice)"></span>
                    </div>
                    <div class="w-10 h-10 bg-slate-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                        <img src="https://ui-avatars.com/api/?name=Admin+Cafe&background=0D8ABC&color=fff" alt="Avatar">
                    </div>
                </div>
            </header>

            <div class="p-6 md:p-8 max-w-7xl mx-auto">
                
                <section x-show="activeTab === 'bahan'" x-cloak class="space-y-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div class="bg-white ios-card shadow-sm border border-gray-100 overflow-hidden">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50/50 border-b border-gray-100">
                                    <tr>
                                        <th class="px-6 py-4 text-[10px] font-bold text-gray-400 uppercase">Bahan Baku</th>
                                        <th class="px-6 py-4 text-[10px] font-bold text-gray-400 uppercase">Kategori</th>
                                        <th class="px-6 py-4 text-[10px] font-bold text-gray-400 uppercase text-right">Harga Beli</th>
                                        <th class="px-6 py-4 text-[10px] font-bold text-gray-400 uppercase text-center">Isi/Satuan</th>
                                        <th class="px-6 py-4 text-[10px] font-bold text-blue-500 uppercase text-right">Hrg / Unit</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-50">
                                    <template x-for="item in bahanBaku" :key="item.nama">
                                        <tr class="hover:bg-gray-50/50 transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="font-bold text-sm text-slate-800" x-text="item.nama"></div>
                                                <div class="text-[10px] text-gray-400" x-text="item.brand || 'Original'"></div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span :class="getCatColor(item.kategori)" class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-sm" x-text="item.kategori"></span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <input type="number" x-model.number="item.hargaBeli" @input="calculateAll()" 
                                                    class="w-24 bg-gray-50 border-none rounded-lg px-2 py-1 text-right font-mono text-sm focus:ring-2 focus:ring-blue-500">
                                            </td>
                                            <td class="px-6 py-4 text-center text-xs font-medium text-gray-500" x-text="item.isi + ' ' + item.satuan"></td>
                                            <td class="px-6 py-4 text-right font-mono font-bold text-blue-600 text-sm">Rp <span x-text="formatNumber(item.hargaSatuan)"></span></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section x-show="activeTab === 'resep'" x-cloak>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="res in resepList" :key="res.menu">
                            <div class="bg-white ios-card p-6 shadow-sm border border-gray-100 flex flex-col">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="font-bold text-lg text-slate-900 leading-tight" x-text="res.menu"></h3>
                                    <span :class="getMenuCatColor(res.menu)" class="px-2 py-1 rounded-md text-[9px] font-black uppercase" x-text="getMenuCategory(res.menu)"></span>
                                </div>
                                <div class="flex-1 space-y-3">
                                    <template x-for="ing in res.komposisi">
                                        <div class="flex justify-between items-center text-xs">
                                            <span class="text-slate-500" x-text="ing.nama"></span>
                                            <div class="flex gap-4">
                                                <span class="text-gray-300 italic" x-text="ing.qty + ' ' + ing.unit"></span>
                                                <span class="font-mono font-semibold" x-text="formatNumber(calculateIngCost(ing.nama, ing.qty))"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div class="mt-6 pt-4 border-t border-dashed flex justify-between items-center">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase">HPP Menu</span>
                                    <span class="text-xl font-black text-blue-600">Rp <span x-text="formatNumber(calculateMenuHPP(res.menu))"></span></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </section>

                <section x-show="activeTab === 'menu'" x-cloak>
                    <div class="bg-white ios-card shadow-sm border border-gray-100 overflow-hidden">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-900 text-white">
                                <tr>
                                    <th class="px-6 py-5 text-[10px] font-bold uppercase tracking-widest">Product</th>
                                    <th class="px-6 py-5 text-[10px] font-bold uppercase tracking-widest text-right">Price</th>
                                    <th class="px-6 py-5 text-[10px] font-bold uppercase tracking-widest text-right">Cost (HPP)</th>
                                    <th class="px-6 py-5 text-[10px] font-bold uppercase tracking-widest text-center">Margin %</th>
                                    <th class="px-6 py-5 text-[10px] font-bold uppercase tracking-widest">AI Performance</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <template x-for="m in menuItems" :key="m.nama">
                                    <tr class="hover:bg-slate-50 transition-colors">
                                        <td class="px-6 py-4">
                                            <div class="font-bold text-slate-800" x-text="m.nama"></div>
                                            <div class="text-[10px] font-medium text-gray-400 uppercase" x-text="m.kategori"></div>
                                        </td>
                                        <td class="px-6 py-4 text-right font-mono font-medium">Rp <span x-text="formatNumber(m.hargaJual)"></span></td>
                                        <td class="px-6 py-4 text-right font-mono text-red-500">Rp <span x-text="formatNumber(calculateMenuHPP(m.nama))"></span></td>
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col items-center gap-1">
                                                <span class="text-xs font-black" :class="calculateMargin(m.nama) < 50 ? 'text-red-500' : 'text-green-600'" x-text="calculateMargin(m.nama) + '%'"></span>
                                                <div class="w-12 bg-gray-100 h-1.5 rounded-full overflow-hidden">
                                                    <div class="h-full" :class="calculateMargin(m.nama) < 50 ? 'bg-red-500' : 'bg-green-500'" :style="`width: ${calculateMargin(m.nama)}%`"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div :class="getInsightColor(calculateMargin(m.nama))" class="text-[10px] p-2 rounded-xl font-bold italic" x-text="getMenuInsight(calculateMargin(m.nama))"></div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section x-show="activeTab === 'dashboard'" x-cloak class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 ios-card shadow-sm border border-gray-100">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Average Margin</span>
                            <h4 class="text-4xl font-black text-blue-600" x-text="avgMargin + '%'"></h4>
                            <div class="mt-2 text-[10px] font-bold text-green-500 flex items-center gap-1">
                                <span>â–²</span> 2.4% vs last month
                            </div>
                        </div>
                        <div class="bg-white p-6 ios-card shadow-sm border border-gray-100">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">HPP Terkoreksi</span>
                            <h4 class="text-xl font-black text-slate-800" x-text="highestHPP.name"></h4>
                            <span class="text-xs font-mono text-red-500" x-text="'Rp ' + formatNumber(highestHPP.val)"></span>
                        </div>
                        <div class="bg-white p-6 ios-card shadow-sm border border-gray-100">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Dec Revenue</span>
                            <h4 class="text-2xl font-black text-slate-800">Rp 103.811.000</h4>
                            <span class="text-[10px] text-gray-400 italic">Recap Report Loaded</span>
                        </div>
                        <div class="bg-white p-6 ios-card shadow-sm border border-gray-100">
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Net Profit Est.</span>
                            <h4 class="text-2xl font-black text-green-600" x-text="'Rp ' + formatNumber(calculateNetProfit())"></h4>
                            <span class="text-[10px] text-gray-400">After Tax & Ops</span>
                        </div>
                    </div>

                    <div class="bg-black ios-card p-10 text-white relative overflow-hidden shadow-2xl">
                        <div class="absolute -right-20 -top-20 w-80 h-80 bg-blue-600/20 rounded-full blur-[100px]"></div>
                        <div class="relative z-10 flex flex-col md:flex-row gap-12">
                            <div class="flex-1">
                                <div class="inline-block bg-blue-600 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-6">AI Global Insight</div>
                                <h3 class="text-3xl font-bold mb-6 tracking-tight">Apa kata data Anda hari ini?</h3>
                                <p class="text-slate-400 text-sm leading-relaxed mb-8" x-text="globalInsight"></p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10 hover:bg-white/10 transition-colors cursor-pointer">
                                        <p class="text-xs font-bold text-blue-400 mb-2 italic">Strategi Volume</p>
                                        <p class="text-[10px] text-slate-300">"Tuan Rumah Ice" memiliki demand tertinggi. Kurangi takaran Creamer 2gr untuk profit ekstra Rp 1.2jt/bln.</p>
                                    </div>
                                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10 hover:bg-white/10 transition-colors cursor-pointer">
                                        <p class="text-xs font-bold text-amber-400 mb-2 italic">Peringatan Supply</p>
                                        <p class="text-[10px] text-slate-300">Harga Biji Arabika Diks naik di pasaran. Segera update Database Bahan Baku untuk koreksi margin Americano.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="w-full md:w-72 space-y-4">
                                <div class="bg-white/5 p-6 rounded-3xl border border-white/10 backdrop-blur-md">
                                    <p class="text-[10px] font-bold text-slate-500 uppercase mb-4 text-center">Category Health</p>
                                    <div class="space-y-6">
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1 font-bold"><span>COFFEE BASED</span><span>72%</span></div>
                                            <div class="h-1 bg-white/10 rounded-full"><div class="h-full bg-blue-500 w-[72%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1 font-bold"><span>NON-COFFEE</span><span>58%</span></div>
                                            <div class="h-1 bg-white/10 rounded-full"><div class="h-full bg-pink-500 w-[58%]"></div></div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-[10px] mb-1 font-bold"><span>TEA SERIES</span><span>82%</span></div>
                                            <div class="h-1 bg-white/10 rounded-full"><div class="h-full bg-green-500 w-[82%]"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section x-show="activeTab === 'finance'" x-cloak class="space-y-8">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-6">
                            <div class="bg-white p-8 ios-card shadow-sm border border-gray-100">
                                <h3 class="font-black text-xs uppercase tracking-widest text-gray-400 mb-8">Cash Flow Input</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Total Pendapatan (Gross)</label>
                                        <div class="relative">
                                            <span class="absolute left-4 top-3.5 text-green-600 font-bold">Rp</span>
                                            <input type="number" x-model.number="finance.revenue" 
                                                class="w-full pl-12 pr-4 py-4 bg-green-50/50 border-none rounded-2xl font-mono text-xl font-black text-green-700 focus:ring-2 focus:ring-green-500 outline-none transition-all">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Ops Dapur</label>
                                            <input type="number" x-model.number="finance.opexDapur" class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl font-mono text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                        </div>
                                        <div>
                                            <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Ops Bar</label>
                                            <input type="number" x-model.number="finance.opexBar" class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl font-mono text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-8 p-4 bg-blue-50 rounded-2xl border border-blue-100 italic text-[10px] text-blue-600">
                                    *Data overhead (Gaji & Listrik) dikunci otomatis berdasarkan kontrak 8 karyawan.
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-2">
                            <div class="bg-white ios-card shadow-2xl border border-gray-100 overflow-hidden">
                                <div class="bg-slate-900 p-8 text-white flex justify-between items-center">
                                    <div>
                                        <h3 class="text-2xl font-black tracking-tighter uppercase italic">Profit Analysis</h3>
                                        <p class="text-[10px] text-slate-400 font-bold tracking-widest">REAL-TIME BUSINESS INTELLIGENCE</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-[10px] block text-slate-500 font-bold">ESTIMATED NET PROFIT</span>
                                        <span class="text-4xl font-black text-blue-500" x-text="'Rp ' + formatNumber(calculateNetProfit())"></span>
                                    </div>
                                </div>
                                <div class="p-8 space-y-6">
                                    <div class="flex justify-between items-center pb-4 border-b border-gray-50">
                                        <span class="text-sm font-bold text-slate-500">Gross Revenue</span>
                                        <span class="font-mono font-black text-green-600" x-text="'Rp ' + formatNumber(finance.revenue)"></span>
                                    </div>
                                    <div class="flex justify-between items-center pb-4 border-b border-gray-50">
                                        <div class="flex flex-col">
                                            <span class="text-sm font-bold text-slate-500">Cost of Goods Sold (COGS)</span>
                                            <span class="text-[9px] text-gray-400 italic">Berdasarkan rata-rata penggunaan bahan 35%</span>
                                        </div>
                                        <span class="font-mono text-red-500 font-bold" x-text="'- Rp ' + formatNumber(finance.revenue * 0.35)"></span>
                                    </div>
                                    <div class="flex justify-between items-center pb-4 border-b border-gray-50">
                                        <span class="text-sm font-bold text-slate-500 uppercase">Operational Expense</span>
                                        <span class="font-mono text-red-500 font-bold" x-text="'- Rp ' + formatNumber(finance.opexDapur + finance.opexBar)"></span>
                                    </div>
                                    <div class="flex justify-between items-center pb-4 border-b border-gray-100 italic">
                                        <div class="flex flex-col text-slate-400">
                                            <span class="text-sm font-bold uppercase">Total Overhead</span>
                                            <span class="text-[9px]">Gaji (12jt) + Listrik (6jt)</span>
                                        </div>
                                        <span class="font-mono text-red-400 font-bold" x-text="'- Rp ' + formatNumber(overheadTotal)"></span>
                                    </div>
                                    
                                    <div class="pt-6">
                                        <div class="bg-blue-600/5 p-6 rounded-3xl border border-blue-600/10 flex items-start gap-4">
                                            <div class="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg">
                                                <span class="text-white font-black text-xs italic">AI</span>
                                            </div>
                                            <div>
                                                <h5 class="text-xs font-black text-blue-700 uppercase mb-1 italic">Financial Insight Korporat</h5>
                                                <p class="text-sm text-slate-600 italic" x-text="getFinanceInsight()"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        function coffeeApp() {
            return {
                activeTab: 'dashboard',
                tabs: [
                    { id: 'dashboard', name: 'Analisa Global', icon: 'ðŸ“Š' },
                    { id: 'bahan', name: 'Database Bahan', icon: 'ðŸ“¦' },
                    { id: 'resep', name: 'Resep Menu', icon: 'ðŸ§¾' },
                    { id: 'menu', name: 'Pricing & Margin', icon: 'ðŸ·ï¸' },
                    { id: 'finance', name: 'Keuangan', icon: 'ðŸ’°' }
                ],
                
                // DATA LENGKAP BAHAN BAKU
                bahanBaku: [
                    { nama: 'Arabika Grade 1 Kaks', kategori: 'Kopi', satuan: 'gr', hargaBeli: 240000, isi: 1000, brand: 'Kaks Roastery' },
                    { nama: 'Arabika Specialty Diks', kategori: 'Kopi', satuan: 'gr', hargaBeli: 280000, isi: 1000, brand: 'Diks Specialty' },
                    { nama: 'Monin Caramel', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Vanilla', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Tiramisu', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Banana', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Butterscotch', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Pandan', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Apple', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'Monin Lychee', kategori: 'Syrup', satuan: 'ml', hargaBeli: 175000, isi: 700, brand: 'Monin' },
                    { nama: 'UHT Diamond', kategori: 'Dairy', satuan: 'ml', hargaBeli: 21000, isi: 1000, brand: 'Diamond' },
                    { nama: 'Oatside', kategori: 'Dairy', satuan: 'ml', hargaBeli: 42000, isi: 1000, brand: 'Oatside' },
                    { nama: 'Susu Evaporasi', kategori: 'Dairy', satuan: 'ml', hargaBeli: 18500, isi: 380, brand: 'F&N' },
                    { nama: 'SKM', kategori: 'Dairy', satuan: 'ml', hargaBeli: 15000, isi: 375, brand: 'Indomilk' },
                    { nama: 'Creamer Max', kategori: 'Powder', satuan: 'gr', hargaBeli: 38000, isi: 500, brand: 'MaxCreamer' },
                    { nama: 'Cheese Cream', kategori: 'Dairy', satuan: 'ml', hargaBeli: 55000, isi: 500, brand: 'Anchor' },
                    { nama: 'Bubuk Matcha', kategori: 'Powder', satuan: 'gr', hargaBeli: 120000, isi: 1000, brand: 'Pure' },
                    { nama: 'Bubuk Coklat', kategori: 'Powder', satuan: 'gr', hargaBeli: 95000, isi: 1000, brand: 'Signature' },
                    { nama: 'Gula Aren', kategori: 'Lain-lain', satuan: 'gr', hargaBeli: 45000, isi: 1000, brand: 'Dainichi' },
                    { nama: 'Es Batu', kategori: 'Operasional', satuan: 'gr', hargaBeli: 70000, isi: 8000, brand: 'Crystal Ice' },
                    { nama: 'Cup Ice 16oz', kategori: 'Operasional', satuan: 'pcs', hargaBeli: 45000, isi: 50, brand: 'Starindo' },
                    { nama: 'Straw', kategori: 'Operasional', satuan: 'pcs', hargaBeli: 15000, isi: 100, brand: 'Oxo' }
                ],

                // DATA LENGKAP MENU
                menuItems: [
                    { nama: 'Kopsus Ice', kategori: 'Coffee Based', hargaJual: 22000 },
                    { nama: 'Tuan Rumah Ice', kategori: 'Coffee Based', hargaJual: 25000 },
                    { nama: 'Tiramisu Coffee', kategori: 'Coffee Based', hargaJual: 28000 },
                    { nama: 'Banana Coffee', kategori: 'Coffee Based', hargaJual: 25000 },
                    { nama: 'Berrycano Ice', kategori: 'Americano Series', hargaJual: 25000 },
                    { nama: 'Matcha Latte', kategori: 'Non Coffee', hargaJual: 28000 },
                    { nama: 'Chocolate Signature', kategori: 'Non Coffee', hargaJual: 25000 },
                    { nama: 'Lychee Tea', kategori: 'Tea Series', hargaJual: 25000 },
                    { nama: 'Magic Hot', kategori: 'Specialty', hargaJual: 28000 }
                ],

                resepList: [
                    { menu: 'Kopsus Ice', komposisi: [
                        { nama: 'Arabika Grade 1 Kaks', qty: 18, unit: 'gr' },
                        { nama: 'SKM', qty: 20, unit: 'ml' },
                        { nama: 'Creamer Max', qty: 15, unit: 'gr' },
                        { nama: 'Susu Evaporasi', qty: 10, unit: 'ml' },
                        { nama: 'UHT Diamond', qty: 70, unit: 'ml' },
                        { nama: 'Es Batu', qty: 150, unit: 'gr' },
                        { nama: 'Cup Ice 16oz', qty: 1, unit: 'pcs' }
                    ]},
                    { menu: 'Tuan Rumah Ice', komposisi: [
                        { nama: 'Arabika Grade 1 Kaks', qty: 18, unit: 'gr' },
                        { nama: 'Gula Aren', qty: 25, unit: 'gr' },
                        { nama: 'Creamer Max', qty: 25, unit: 'gr' },
                        { nama: 'UHT Diamond', qty: 100, unit: 'ml' },
                        { nama: 'Es Batu', qty: 150, unit: 'gr' },
                        { nama: 'Cup Ice 16oz', qty: 1, unit: 'pcs' }
                    ]},
                    { menu: 'Berrycano Ice', komposisi: [
                        { nama: 'Arabika Specialty Diks', qty: 18, unit: 'gr' },
                        { nama: 'Monin Caramel', qty: 20, unit: 'ml' }, // Grenadine proxy
                        { nama: 'Es Batu', qty: 200, unit: 'gr' },
                        { nama: 'Cup Ice 16oz', qty: 1, unit: 'pcs' }
                    ]},
                    { menu: 'Matcha Latte', komposisi: [
                        { nama: 'Bubuk Matcha', qty: 20, unit: 'gr' },
                        { nama: 'SKM', qty: 15, unit: 'ml' },
                        { nama: 'UHT Diamond', qty: 110, unit: 'ml' },
                        { nama: 'Es Batu', qty: 150, unit: 'gr' },
                        { nama: 'Cup Ice 16oz', qty: 1, unit: 'pcs' }
                    ]}
                ],

                finance: { revenue: 103811000, opexDapur: 5000000, opexBar: 4500000 },
                overhead: { karyawan: 8, gaji: 1500000, listrik: 200000 },
                espressoPrice: 0,
                avgMargin: 0,
                highestHPP: { name: '', val: 0 },
                globalInsight: '',

                init() {
                    this.calculateAll();
                },

                calculateAll() {
                    this.bahanBaku.forEach(b => b.hargaSatuan = b.hargaBeli / b.isi);
                    const beans = this.bahanBaku.find(b => b.nama.includes('Diks'));
                    this.espressoPrice = 18 * beans.hargaSatuan;

                    let totalMargin = 0;
                    let maxHPP = 0;
                    let maxHPPName = '';

                    this.menuItems.forEach(m => {
                        const hpp = this.calculateMenuHPP(m.nama);
                        const margin = ((m.hargaJual - hpp) / m.hargaJual) * 100;
                        totalMargin += margin;
                        if(hpp > maxHPP) { maxHPP = hpp; maxHPPName = m.nama; }
                    });

                    this.avgMargin = Math.round(totalMargin / this.menuItems.length);
                    this.highestHPP = { name: maxHPPName, val: maxHPP };
                    this.updateGlobalInsight();
                },

                calculateIngCost(nama, qty) {
                    const bahan = this.bahanBaku.find(b => b.nama === nama);
                    return bahan ? bahan.hargaSatuan * qty : 0;
                },

                calculateMenuHPP(menuNama) {
                    const resep = this.resepList.find(r => r.menu === menuNama);
                    if (!resep) return 7500; // Average fallback
                    return resep.komposisi.reduce((total, ing) => total + this.calculateIngCost(ing.nama, ing.qty), 0);
                },

                calculateMargin(menuNama) {
                    const m = this.menuItems.find(i => i.nama === menuNama);
                    const hpp = this.calculateMenuHPP(menuNama);
                    return Math.round(((m.hargaJual - hpp) / m.hargaJual) * 100);
                },

                getCatColor(cat) {
                    const colors = {
                        'Kopi': 'bg-amber-100 text-amber-700',
                        'Syrup': 'bg-pink-100 text-pink-700',
                        'Dairy': 'bg-blue-100 text-blue-700',
                        'Powder': 'bg-purple-100 text-purple-700',
                        'Operasional': 'bg-slate-100 text-slate-700',
                        'Lain-lain': 'bg-teal-100 text-teal-700'
                    };
                    return colors[cat] || 'bg-gray-100 text-gray-700';
                },

                getMenuCatColor(menuNama) {
                    const m = this.menuItems.find(i => i.nama === menuNama);
                    const cat = m ? m.kategori : '';
                    const colors = {
                        'Coffee Based': 'bg-amber-500 text-white',
                        'Americano Series': 'bg-red-500 text-white',
                        'Non Coffee': 'bg-pink-500 text-white',
                        'Tea Series': 'bg-green-500 text-white',
                        'Specialty': 'bg-slate-900 text-white'
                    };
                    return colors[cat] || 'bg-gray-500 text-white';
                },

                getMenuCategory(menuNama) {
                    const m = this.menuItems.find(i => i.nama === menuNama);
                    return m ? m.kategori : 'Misc';
                },

                getMenuInsight(margin) {
                    if (margin < 50) return "Margin Kritis: Evaluasi Harga!";
                    if (margin >= 50 && margin <= 70) return "Performa Sehat";
                    return "Profit Maksimal";
                },

                getInsightColor(margin) {
                    if (margin < 50) return "text-red-600 bg-red-50 border border-red-100";
                    if (margin >= 50 && margin <= 70) return "text-blue-600 bg-blue-50 border border-blue-100";
                    return "text-green-600 bg-green-50 border border-green-100";
                },

                updateGlobalInsight() {
                    this.globalInsight = `Bulan ini, rasio margin Anda berada di ${this.avgMargin}%. Dengan revenue Rp 103jt, menu 'Tuan Rumah Ice' menyumbang profit kotor terbesar. Namun, waspadai kenaikan harga UHT Diamond dan Syrup Monin yang bisa menggerus profit bersih hingga 5% jika stok tidak dikelola dengan FIFO.`;
                },

                calculateNetProfit() {
                    const cogs = this.finance.revenue * 0.35;
                    const opex = this.finance.opexDapur + this.finance.opexBar;
                    return this.finance.revenue - cogs - opex - this.overheadTotal;
                },

                getFinanceInsight() {
                    const profit = this.calculateNetProfit();
                    if (profit > 25000000) return "Sangat Menguntungkan. Anda memiliki cadangan kas yang cukup untuk renovasi atau bonus karyawan.";
                    return "Profit Stabil. Pastikan pengeluaran harian bar tetap terkontrol di bawah Rp 200rb.";
                },

                get overheadTotal() {
                    return (this.overhead.karyawan * this.overhead.gaji) + (this.overhead.listrik * 30);
                },

                formatNumber(num) {
                    return new Intl.NumberFormat('id-ID').format(Math.round(num));
                }
            }
        }
    </script>
</body>
</html>
