<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tuan Rumah Coffee | AI Business Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f1f5f9; color: #1e293b; }
        .ios-blur { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .active-tab { color: #f97316; border-bottom: 3px solid #f97316; font-weight: 800; }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="pb-24">

    <header class="ios-blur border-b border-slate-200 sticky top-0 z-40 px-6 pt-6 pb-2">
        <div class="flex justify-between items-end mb-4">
            <div>
                <h1 class="text-2xl font-black text-slate-900 tracking-tighter italic">TUAN RUMAH <span class="text-orange-600">PRO</span></h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">AI Analytics & Operations</p>
            </div>
            <button onclick="syncAll()" class="bg-slate-900 text-white text-[10px] font-black px-4 py-2.5 rounded-2xl shadow-lg active:scale-95 transition-all">SYNC GITHUB DATA</button>
        </div>
        
        <div class="flex gap-8 overflow-x-auto no-scrollbar">
            <button onclick="switchTab(event, 'tab-dashboard')" class="tab-btn active-tab py-3 text-xs font-bold uppercase whitespace-nowrap">Dashboard AI</button>
            <button onclick="switchTab(event, 'tab-menu')" class="tab-btn py-3 text-xs font-bold uppercase whitespace-nowrap text-slate-400">Resep & HPP</button>
            <button onclick="switchTab(event, 'tab-strategy')" class="tab-btn py-3 text-xs font-bold uppercase whitespace-nowrap text-slate-400">Strategi Omset</button>
        </div>
    </header>

    <main class="p-4 max-w-6xl mx-auto">
        
        <section id="tab-dashboard" class="tab-content active space-y-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-[32px] card-shadow border border-white">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Total Penjualan</p>
                    <h2 id="stat-revenue" class="text-xl font-black text-slate-800">Rp 0</h2>
                </div>
                <div class="bg-white p-5 rounded-[32px] card-shadow border border-white">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Cup Terjual</p>
                    <h2 id="stat-qty" class="text-xl font-black text-orange-600">0</h2>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white p-6 rounded-[40px] card-shadow">
                    <h3 class="font-black text-slate-800 mb-4">Grafik Performa Menu</h3>
                    <canvas id="salesChart" height="200"></canvas>
                </div>
                
                <div class="bg-orange-600 p-6 rounded-[40px] text-white card-shadow shadow-orange-200">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="p-2 bg-white/20 rounded-lg">‚ú®</div>
                        <h3 class="font-black">AI Business Insight</h3>
                    </div>
                    <div id="ai-insight-text" class="text-sm font-medium leading-relaxed space-y-3">
                        Menganalisis data...
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-menu" class="tab-content">
            <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>

        <section id="tab-strategy" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-8 rounded-[40px] card-shadow">
                    <h3 class="text-xl font-black text-slate-800 mb-6 flex items-center gap-3">
                        <span class="text-orange-600">üí∞</span> Saran Harga Jual
                    </h3>
                    <div id="pricing-strategy" class="space-y-4 text-sm text-slate-600">
                        </div>
                </div>
                <div class="bg-slate-900 p-8 rounded-[40px] card-shadow text-white">
                    <h3 class="text-xl font-black mb-6 flex items-center gap-3">
                        <span class="text-orange-400">üìà</span> 5 Langkah Naik Omset
                    </h3>
                    <ul class="space-y-4 text-sm text-slate-300">
                        <li class="flex gap-3"><b class="text-orange-400">01.</b> Bundle Best Seller (Tuan Rumah) dengan menu margin tinggi (Tea Series).</li>
                        <li class="flex gap-3"><b class="text-orange-400">02.</b> Program "Loyalty Stamp" khusus pembelian via WhatsApp/Direct.</li>
                        <li class="flex gap-3"><b class="text-orange-400">03.</b> Upselling: Tawarkan add-on Cheese Cream untuk setiap menu Non-Coffee.</li>
                        <li class="flex gap-3"><b class="text-orange-400">04.</b> Happy Hour: Diskon 15% pada jam sepi (14:00 - 16:00) khusus menu Coffee.</li>
                        <li class="flex gap-3"><b class="text-orange-400">05.</b> Optimasi Konten: Post visual menu terlaris di jam makan siang & pulang kantor.</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <script>
        const RAW_URL = 'https://raw.githubusercontent.com/OcangAmin/Dashboard-TR/main/Github%20data.csv';
        let fullData = [];
        let salesChart = null;

        async function syncAll() {
            try {
                const res = await fetch(RAW_URL);
                const text = await res.text();
                Papa.parse(text, {
                    complete: function(results) {
                        fullData = results.data;
                        analyzeSales(results.data);
                        renderResep(results.data);
                    }
                });
            } catch (e) { alert("Gagal Sync. Pastikan URL GitHub benar."); }
        }

        function analyzeSales(data) {
            let totalRevenue = 0;
            let totalQty = 0;
            let menuStats = {};

            data.forEach(row => {
                // Mencari baris yang berisi data penjualan (Kolom 1: BEVERAGE)
                if (row[0] === 'BEVERAGE') {
                    const name = row[2];
                    const qty = parseInt(row[3]) || 0;
                    const total = parseInt(row[5]) || 0;
                    
                    if (qty > 0) {
                        totalRevenue += total;
                        totalQty += qty;
                        menuStats[name] = (menuStats[name] || 0) + qty;
                    }
                }
            });

            document.getElementById('stat-revenue').innerText = 'Rp ' + totalRevenue.toLocaleString();
            document.getElementById('stat-qty').innerText = totalQty.toLocaleString() + ' Cups';

            updateChart(menuStats);
            generateAIInsight(menuStats, totalRevenue);
        }

        function generateAIInsight(stats, revenue) {
            const sorted = Object.entries(stats).sort((a,b) => b[1] - a[1]);
            const best = sorted[0] || ["-", 0];
            const low = sorted[sorted.length - 1] || ["-", 0];

            const insightBox = document.getElementById('ai-insight-text');
            insightBox.innerHTML = `
                <p>üöÄ <b>Star Product:</b> Menu <b>${best[0]}</b> mendominasi penjualan. Pastikan stok bahan baku utama tidak pernah kosong.</p>
                <p>‚ö†Ô∏è <b>Low Performer:</b> Menu <b>${low[0]}</b> memiliki perputaran lambat. Pertimbangkan untuk menghapus atau menjadikannya promo 'Buy 1 Get 1'.</p>
                <p>üí° <b>Saran:</b> Total omset Anda sudah baik. Untuk meningkatkan profit, dorong penjualan menu <b>Signature</b> yang memiliki margin lebih lebar dibanding Coffee Based.</p>
            `;

            const priceBox = document.getElementById('pricing-strategy');
            priceBox.innerHTML = `
                <div class="p-4 bg-orange-50 rounded-2xl border border-orange-100">
                    <p class="font-bold text-orange-800">Optimasi Harga ${best[0]}</p>
                    <p class="text-xs">Menu ini sangat diminati. Anda bisa menaikkan harga Rp 1.000 - Rp 2.000 tanpa mengurangi minat pelanggan ƒë√°ng signifikan.</p>
                </div>
                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                    <p class="font-bold text-slate-800">Harga Psikologis</p>
                    <p class="text-xs">Gunakan harga Rp 23.000 atau Rp 27.000 daripada harga bulat untuk meningkatkan konversi pembelian impulsif.</p>
                </div>
            `;
        }

        function updateChart(stats) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const labels = Object.keys(stats).slice(0, 7);
            const values = Object.values(stats).slice(0, 7);

            if(salesChart) salesChart.destroy();
            salesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Qty Terjual',
                        data: values,
                        backgroundColor: '#f97316',
                        borderRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } }
                }
            });
        }

        function renderResep(data) {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            let currentMenu = "";
            
            data.forEach(row => {
                const line = row[0] ? row[0].trim() : "";
                if(line.endsWith(':')) {
                    const name = line.replace(':','');
                    container.innerHTML += `
                        <div class="bg-white p-6 rounded-[32px] card-shadow border border-white">
                            <h3 class="font-black text-slate-800 mb-2">${name}</h3>
                            <p class="text-[10px] font-bold text-orange-600 uppercase tracking-tighter">Resep Terintegrasi</p>
                        </div>
                    `;
                }
            });
        }

        function switchTab(e, id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.add('text-slate-400'));
            document.getElementById(id).classList.add('active');
            e.currentTarget.classList.remove('text-slate-400');
            e.currentTarget.classList.add('active-tab');
        }

        syncAll();
    </script>
</body>
</html>
