<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tuan Rumah Coffee - Integrated Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .ios-tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; padding-bottom: calc(10px + env(safe-area-inset-bottom)); }
        .active-tab { color: #2563eb; font-weight: 700; }
        .tab-content { display: none; padding-bottom: 100px; }
        .tab-content.active { display: block; }
        .scroll-x { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .badge-low { background: #fee2e2; color: #991b1b; }
        .badge-mid { background: #fef9c3; color: #854d0e; }
        .badge-high { background: #dcfce7; color: #166534; }
    </style>
</head>
<body>

    <header class="p-4 bg-white sticky top-0 z-50 border-bottom shadow-sm">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">â˜• TNRC Dashboard</h1>
            <span id="current-date" class="text-xs text-gray-500 font-medium"></span>
        </div>
    </header>

    <main class="p-4">
        <section id="global-params" class="hidden">
            </section>

        <div id="tab-dashboard" class="tab-content active">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                <div class="glass-card p-4 rounded-2xl">
                    <p class="text-xs text-gray-500 uppercase">Avg. Margin</p>
                    <h3 id="stat-avg-margin" class="text-xl font-bold text-blue-600">--%</h3>
                </div>
                <div class="glass-card p-4 rounded-2xl">
                    <p class="text-xs text-gray-500 uppercase">Daily Overhead</p>
                    <h3 class="text-xl font-bold text-gray-800">Rp200k</h3>
                </div>
                <div class="glass-card p-4 rounded-2xl">
                    <p class="text-xs text-gray-500 uppercase">Total Staff</p>
                    <h3 class="text-xl font-bold text-gray-800">8 Org</h3>
                </div>
                <div class="glass-card p-4 rounded-2xl">
                    <p class="text-xs text-gray-500 uppercase">HPP Termahal</p>
                    <h3 id="stat-highest-hpp" class="text-sm font-bold text-red-600">--</h3>
                </div>
            </div>

            <div class="glass-card p-5 rounded-2xl border-l-4 border-blue-500 mb-6">
                <h4 class="text-sm font-bold flex items-center gap-2 mb-2">
                    âœ¨ AI Business Insights
                </h4>
                <div id="ai-global-insight" class="text-sm text-gray-600 leading-relaxed">
                    Menganalisa data...
                </div>
            </div>

            <div class="glass-card p-5 rounded-2xl mb-6">
                <h4 class="text-sm font-bold mb-4">Input Keuangan Bulan Ini</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs mb-1">Pendapatan Total (Rp)</label>
                        <input type="number" id="in-revenue" class="w-full p-2 border rounded-lg text-sm" placeholder="Contoh: 50000000" onchange="updateFinance()">
                    </div>
                    <div>
                        <label class="block text-xs mb-1">Belanja Dapur & Bar (Rp)</label>
                        <input type="number" id="in-exp-raw" class="w-full p-2 border rounded-lg text-sm" placeholder="Sesuai struk belanja" onchange="updateFinance()">
                    </div>
                </div>
                <div id="finance-result" class="mt-4 p-3 bg-gray-50 rounded-lg text-xs grid grid-cols-2 gap-2">
                    </div>
            </div>
        </div>

        <div id="tab-bahan" class="tab-content">
            <h2 class="text-lg font-bold mb-4">Database Bahan Baku</h2>
            <div class="glass-card rounded-2xl overflow-hidden">
                <div class="scroll-x">
                    <table id="table-bahan">
                        <thead class="bg-gray-50">
                            <tr>
                                <th>Bahan</th>
                                <th>Kategori</th>
                                <th>Isi</th>
                                <th>Harga</th>
                                <th>/Unit</th>
                            </tr>
                        </thead>
                        <tbody id="body-bahan"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-menu" class="tab-content">
            <h2 class="text-lg font-bold mb-4">Menu & Profit Analysis</h2>
            <div class="glass-card rounded-2xl overflow-hidden">
                <div class="scroll-x">
                    <table id="table-menu">
                        <thead class="bg-gray-50">
                            <tr>
                                <th>Menu</th>
                                <th>HPP</th>
                                <th>Harga Jual</th>
                                <th>Margin</th>
                                <th>AI Insight</th>
                            </tr>
                        </thead>
                        <tbody id="body-menu"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <nav class="ios-tab-bar">
        <button onclick="switchTab('dashboard')" id="nav-dashboard" class="flex flex-col items-center active-tab">
            <span class="text-[20px]">ðŸ“Š</span>
            <span class="text-[10px]">Insight</span>
        </button>
        <button onclick="switchTab('bahan')" id="nav-bahan" class="flex flex-col items-center">
            <span class="text-[20px]">ðŸ“¦</span>
            <span class="text-[10px]">Bahan</span>
        </button>
        <button onclick="switchTab('menu')" id="nav-menu" class="flex flex-col items-center">
            <span class="text-[20px]">â˜•</span>
            <span class="text-[10px]">Menu</span>
        </button>
    </nav>

    <script>
        // --- 1. STATE & DATABASE ---
        const state = {
            bahan: [
                { id: 1, nama: "Kaks Arabika G1", cat: "Kopi", brand: "Local", isi: 1000, satuan: "gr", harga: 240000 },
                { id: 2, nama: "Diks Arabika Spl", cat: "Kopi", brand: "Specialty", isi: 1000, satuan: "gr", harga: 280000 },
                { id: 3, nama: "Monin Syrup (Avg)", cat: "Syrup", brand: "Monin", isi: 700, satuan: "ml", harga: 150000 },
                { id: 4, nama: "UHT Diamond", cat: "Dairy", brand: "Diamond", isi: 1000, satuan: "ml", harga: 19000 },
                { id: 5, nama: "Susu Evaporasi", cat: "Dairy", brand: "Sunbay", isi: 380, satuan: "ml", harga: 16500 },
                { id: 6, nama: "SKM", cat: "Dairy", brand: "Omela", isi: 370, satuan: "gr", harga: 12500 },
                { id: 7, nama: "Powder (Avg)", cat: "Powder", brand: "Premix", isi: 1000, satuan: "gr", harga: 85000 },
                { id: 8, nama: "Es Batu", cat: "Operasional", brand: "Crystal", isi: 8000, satuan: "gr", harga: 70000 },
                { id: 9, nama: "Cup + Lid Ice", cat: "Operasional", brand: "-", isi: 1, satuan: "pcs", harga: 850 },
                { id: 10, nama: "Oatside", cat: "Dairy", brand: "Oatside", isi: 1000, satuan: "ml", harga: 45000 },
                { id: 11, nama: "Gula Aren", cat: "Lain-lain", brand: "Dainichi", isi: 1000, satuan: "ml", harga: 65000 },
                { id: 12, nama: "Yakult", cat: "Lain-lain", brand: "Yakult", isi: 1, satuan: "pcs", harga: 2500 },
                { id: 13, nama: "Sprite", cat: "Lain-lain", brand: "CocaCola", isi: 1500, satuan: "ml", harga: 15000 },
                { id: 14, nama: "Biscoff Spread", cat: "Lain-lain", brand: "Lotus", isi: 400, satuan: "gr", harga: 85000 }
            ],
            // Logic HPP Espresso berdasarkan DB 4
            getEspressoCost(type = 'diks') {
                const b = this.bahan.find(x => x.id === (type === 'kaks' ? 1 : 2));
                const hargaPerGram = b.harga / b.isi;
                return hargaPerGram * 18; // 18gr per double shot (standar espresso)
            },
            getUnitCost(id) {
                const b = this.bahan.find(x => x.id === id);
                return b ? (b.harga / b.isi) : 0;
            }
        };

        const menus = [
            { 
                nama: "Kopi Susu", 
                jual: 25000, 
                resep: [
                    { id: 6, qty: 20 }, // SKM
                    { id: 7, qty: 15 }, // Creamer (pakai avg powder)
                    { id: 5, qty: 10 }, // Evap
                    { id: 4, qty: 70 }, // UHT
                    { type: 'espresso', bean: 'kaks' },
                    { id: 8, qty: 150 }, // Es
                    { id: 9, qty: 1 }    // Packaging
                ]
            },
            { 
                nama: "Tuan Rumah (Ice)", 
                jual: 28000, 
                resep: [
                    { id: 11, qty: 25 }, // Gula Aren
                    { id: 7, qty: 25 },  // Creamer
                    { id: 4, qty: 100 }, // UHT
                    { type: 'espresso', bean: 'kaks' },
                    { id: 8, qty: 150 },
                    { id: 9, qty: 1 }
                ]
            },
            { 
                nama: "Biscoff Latte", 
                jual: 35000, 
                resep: [
                    { id: 14, qty: 15 }, // Spread
                    { id: 3, qty: 10 },  // Syrup
                    { id: 4, qty: 100 }, 
                    { type: 'espresso', bean: 'diks' },
                    { id: 8, qty: 150 },
                    { id: 9, qty: 1 }
                ]
            },
            { 
                nama: "Matcha Latte", 
                jual: 30000, 
                resep: [
                    { id: 7, qty: 20 }, // Powder Matcha
                    { id: 6, qty: 15 }, // SKM
                    { id: 4, qty: 110 }, 
                    { id: 8, qty: 150 },
                    { id: 9, qty: 1 }
                ]
            }
        ];

        // --- 2. CALCULATOR ENGINE ---
        function calculateHPP(resep) {
            let total = 0;
            resep.forEach(r => {
                if(r.type === 'espresso') {
                    total += state.getEspressoCost(r.bean);
                } else {
                    total += (state.getUnitCost(r.id) * r.qty);
                }
            });
            return total;
        }

        // --- 3. UI RENDERING ---
        function renderBahan() {
            const container = document.getElementById('body-bahan');
            container.innerHTML = state.bahan.map(b => `
                <tr>
                    <td class="font-semibold">${b.nama}</td>
                    <td><span class="text-[10px] bg-blue-50 px-2 py-1 rounded">${b.cat}</span></td>
                    <td>${b.isi}${b.satuan}</td>
                    <td>Rp${b.harga.toLocaleString()}</td>
                    <td class="text-blue-600 font-bold">Rp${(b.harga/b.isi).toFixed(1)}</td>
                </tr>
            `).join('');
        }

        function renderMenu() {
            const container = document.getElementById('body-menu');
            let totalMargin = 0;
            let highestHpp = { nama: '', val: 0 };

            container.innerHTML = menus.map(m => {
                const hpp = calculateHPP(m.resep);
                const profit = m.jual - hpp;
                const margin = (profit / m.jual) * 100;
                
                totalMargin += margin;
                if(hpp > highestHpp.val) highestHpp = { nama: m.nama, val: hpp };

                let insight = "";
                let badgeClass = "";
                if(margin < 50) { 
                    insight = "âš ï¸ Evaluasi"; badgeClass = "badge-low";
                } else if(margin <= 70) { 
                    insight = "âœ… Sehat"; badgeClass = "badge-mid";
                } else { 
                    insight = "ðŸ”¥ Tinggi"; badgeClass = "badge-high";
                }

                return `
                    <tr>
                        <td class="font-bold text-gray-700">${m.nama}</td>
                        <td class="text-red-500">Rp${Math.round(hpp).toLocaleString()}</td>
                        <td class="font-semibold">Rp${m.jual.toLocaleString()}</td>
                        <td>${margin.toFixed(1)}%</td>
                        <td><span class="badge ${badgeClass}">${insight}</span></td>
                    </tr>
                `;
            }).join('');

            // Update Dash Stats
            document.getElementById('stat-avg-margin').innerText = (totalMargin / menus.length).toFixed(1) + "%";
            document.getElementById('stat-highest-hpp').innerText = highestHpp.nama;
            
            updateAIInsight(totalMargin / menus.length);
        }

        function updateAIInsight(avgMargin) {
            const box = document.getElementById('ai-global-insight');
            let text = `Berdasarkan data saat ini, rata-rata margin keuntungan Anda berada di angka **${avgMargin.toFixed(1)}%**. `;
            
            if(avgMargin < 60) {
                text += "Perhatian: Biaya operasional (listrik & gaji) dapat menggerus profit. Pertimbangkan menaikkan harga pada menu Specialty atau mengurangi wastage susu.";
            } else {
                text += "Performa margin sangat sehat. Fokus pada volume penjualan dan pertimbangkan program loyalitas untuk menjaga arus kas.";
            }
            box.innerHTML = text;
        }

        function updateFinance() {
            const rev = document.getElementById('in-revenue').value || 0;
            const expRaw = document.getElementById('in-exp-raw').value || 0;
            const overhead = 200000 * 30; // 30 hari
            const gaji = 1500000 * 8;
            const totalExp = parseFloat(expRaw) + overhead + gaji;
            const profit = rev - totalExp;

            document.getElementById('finance-result').innerHTML = `
                <div class="bg-white p-2 border rounded">Pengeluaran Tetap: <br><b>Rp${(overhead+gaji).toLocaleString()}</b></div>
                <div class="bg-white p-2 border rounded">Estimasi Profit: <br><b class="${profit < 0 ? 'text-red-500' : 'text-green-600'}">Rp${profit.toLocaleString()}</b></div>
            `;
        }

        // --- 4. NAVIGATION ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.ios-tab-bar button').forEach(b => b.classList.remove('active-tab'));
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`nav-${tabId}`).classList.add('active-tab');
        }

        // Initialize
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        renderBahan();
        renderMenu();
        updateFinance();

    </script>
</body>
</html>
