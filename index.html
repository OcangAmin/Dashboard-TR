<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuan Rumah Coffee | Business Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-active { @apply bg-orange-600 text-white shadow-xl scale-110; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    </style>
</head>
<body class="text-slate-800">

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 md:top-0 md:left-0 md:translate-x-0 md:h-screen md:w-28 bg-slate-900 text-white flex md:flex-col items-center justify-around py-10 z-50 md:rounded-r-[3rem] w-[90%] rounded-3xl shadow-2xl transition-all">
        <div class="hidden md:block mb-12 text-orange-500 animate-pulse"><i class="fas fa-mug-hot text-4xl"></i></div>
        <button onclick="switchTab('dashboard', this)" class="nav-btn p-5 rounded-3xl text-slate-500 nav-active transition-all"><i class="fas fa-chart-line text-2xl"></i><span class="block text-[8px] mt-1 font-bold">DASHBOARD</span></button>
        <button onclick="switchTab('menu', this)" class="nav-btn p-5 rounded-3xl text-slate-500 transition-all"><i class="fas fa-utensils text-2xl"></i><span class="block text-[8px] mt-1 font-bold">MENU</span></button>
        <button onclick="switchTab('inventory', this)" class="nav-btn p-5 rounded-3xl text-slate-500 transition-all"><i class="fas fa-warehouse text-2xl"></i><span class="block text-[8px] mt-1 font-bold">BAHAN</span></button>
        <button onclick="exportData()" class="md:mt-auto p-5 rounded-3xl text-emerald-400 hover:bg-emerald-600 hover:text-white transition-all"><i class="fas fa-download text-2xl"></i></button>
    </nav>

    <main class="md:ml-36 p-4 md:p-12 pb-32">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div>
                <h1 class="text-5xl font-extrabold tracking-tighter italic">TUAN RUMAH <span class="text-orange-600">COFFEE</span></h1>
                <p class="text-slate-400 font-bold text-xs mt-2 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-ping"></span> 
                    SYSTEM SYNCHRONIZED: <span id="period-text">JANUARI 2026</span>
                </p>
            </div>
            <div class="flex bg-white p-2 rounded-2xl shadow-sm border border-slate-100">
                <button onclick="setPeriod('JAN26')" id="btn-jan" class="px-6 py-2 rounded-xl text-xs font-black transition-all bg-slate-900 text-white">JAN 26</button>
                <button onclick="setPeriod('DES25')" id="btn-des" class="px-6 py-2 rounded-xl text-xs font-black transition-all text-slate-400">DES 25</button>
            </div>
        </header>

        <section id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div class="md:col-span-2 bg-slate-900 text-white p-10 rounded-[3rem] shadow-2xl relative overflow-hidden">
                    <p class="text-orange-400 font-bold text-xs uppercase tracking-[0.2em] mb-4">Total Profit Estimasi</p>
                    <h2 class="text-7xl font-black mb-8" id="dash-profit">Rp 0</h2>
                    <div class="flex gap-6 border-t border-white/10 pt-8">
                        <div><p class="text-[10px] text-slate-500 font-bold uppercase">Volume Terjual</p><p class="text-2xl font-black" id="dash-qty">0 Cups</p></div>
                        <div><p class="text-[10px] text-slate-500 font-bold uppercase">Avg Margin</p><p class="text-2xl font-black text-emerald-400" id="dash-margin">0%</p></div>
                    </div>
                </div>
                <div class="bg-white p-10 rounded-[3rem] border border-slate-200 shadow-sm flex flex-col justify-center text-center">
                    <p class="text-slate-400 font-bold text-xs uppercase mb-4">Revenue Bruto</p>
                    <h3 class="text-4xl font-black text-slate-800" id="dash-revenue">Rp 0</h3>
                    <div class="mt-8 p-4 bg-orange-50 rounded-2xl">
                        <p class="text-[10px] font-black text-orange-600 uppercase">Top Menu</p>
                        <p class="text-lg font-bold" id="dash-top">-</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="menu" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-200">
                    <h3 class="font-black text-sm uppercase tracking-widest text-slate-400 mb-6">Menu Katalog</h3>
                    <div id="menu-container" class="space-y-3 max-h-[60vh] overflow-y-auto pr-4"></div>
                </div>
                <div class="lg:col-span-8 bg-white rounded-[2.5rem] p-10 shadow-sm border-4 border-slate-900 relative">
                    <div id="recipe-placeholder" class="text-center py-20">
                        <i class="fas fa-mouse-pointer text-4xl text-slate-200 mb-4"></i>
                        <p class="text-slate-400 italic">Pilih menu untuk bedah resep & HPP</p>
                    </div>
                    <div id="recipe-detail" class="hidden">
                        </div>
                </div>
            </div>
        </section>

        <section id="inventory" class="tab-content">
            <div class="bg-white rounded-[3rem] p-12 shadow-sm border border-slate-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                    <div>
                        <h3 class="text-3xl font-black italic uppercase">Bahan Baku Master</h3>
                        <p class="text-slate-400 text-sm">Update harga di sini akan mensinkronkan seluruh Profit & HPP Menu.</p>
                    </div>
                    <div class="bg-emerald-100 text-emerald-700 px-5 py-2 rounded-full text-[10px] font-black tracking-widest uppercase">Data Terenkripsi</div>
                </div>
                <div id="inventory-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
            </div>
        </section>
    </main>

    <script>
        // --- 1. DATA BAHAN BAKU (SINKRON KE SEMUA TAB) ---
        let rawPrices = {
            "Arabika Kaks": 240, "Arabika Diks": 280, "Susu UHT Diamond": 19.5, "Susu Evaporasi": 48,
            "Susu Kental Manis": 36, "Creamer Max": 85, "Cheese Cream": 130, "Syrup Monin": 221,
            "Oatside": 42, "Hydro Coco": 25, "Yakult": 2500, "Powder Premium": 95, "Skippy": 170,
            "Lotus Biscoff": 200, "Lotus Biskuit": 2000, "Simple Sugar": 15, "Gula Aren": 35,
            "Sprite": 15, "Tea Base": 10, "Packaging": 1500, "Es Batu": 7
        };

        // --- 2. DATA MASTER MENU (42+ MENU & RESEP) ---
        const ALL_MENU = [
            { name: "Tuan Rumah (Ice)", sell: 25000, jan: 790, des: 757, recipe: { "Gula Aren": 25, "Creamer Max": 25, "Arabika Kaks": 18, "Susu UHT Diamond": 100, "Packaging": 1, "Es Batu": 100 } },
            { name: "Kopsus (Ice)", sell: 22000, jan: 377, des: 372, recipe: { "Susu Kental Manis": 20, "Creamer Max": 15, "Susu Evaporasi": 10, "Arabika Kaks": 18, "Susu UHT Diamond": 70, "Packaging": 1, "Es Batu": 100 } },
            { name: "Matcha Latte", sell: 28000, jan: 358, des: 327, recipe: { "Powder Premium": 20, "Susu Kental Manis": 15, "Creamer Max": 10, "Susu UHT Diamond": 110, "Packaging": 1, "Es Batu": 100 } },
            { name: "Pandan (Ice)", sell: 28000, jan: 382, des: 370, recipe: { "Syrup Monin": 20, "Susu Kental Manis": 10, "Arabika Kaks": 18, "Oatside": 100, "Packaging": 1, "Es Batu": 100 } },
            { name: "Beerycano (Ice)", sell: 25000, jan: 89, des: 62, recipe: { "Syrup Monin": 20, "Simple Sugar": 10, "Arabika Diks": 18, "Packaging": 1, "Es Batu": 100 } },
            { name: "Butterscotch Ice", sell: 28000, jan: 167, des: 186, recipe: { "Syrup Monin": 20, "Susu Kental Manis": 10, "Creamer Max": 15, "Arabika Kaks": 18, "Susu UHT Diamond": 70, "Cheese Cream": 20, "Packaging": 1, "Es Batu": 100 } },
            { name: "Chocolate Ice", sell: 25000, jan: 266, des: 267, recipe: { "Gula Aren": 15, "Powder Premium": 13, "Creamer Max": 10, "Susu UHT Diamond": 100, "Packaging": 1, "Es Batu": 100 } },
            { name: "Vanilla Latte", sell: 23000, jan: 143, des: 158, recipe: { "Syrup Monin": 10, "Susu Kental Manis": 10, "Powder Premium": 10, "Susu UHT Diamond": 100, "Packaging": 1, "Es Batu": 100 } }
        ];

        let activePeriod = "JAN26";

        // --- 3. ENGINE KALKULASI ---
        function calculateHPP(recipe) {
            return Object.entries(recipe).reduce((total, [ing, qty]) => total + (rawPrices[ing] * qty), 0);
        }

        function refreshAll() {
            renderDashboard();
            renderMenuList();
            renderInventory();
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            btn.classList.add('nav-active');
        }

        function setPeriod(p) {
            activePeriod = p;
            document.getElementById('period-text').innerText = p === 'JAN26' ? 'JANUARI 2026' : 'DESEMBER 2025';
            document.getElementById('btn-jan').className = p === 'JAN26' ? 'px-6 py-2 rounded-xl text-xs font-black transition-all bg-slate-900 text-white' : 'px-6 py-2 rounded-xl text-xs font-black transition-all text-slate-400';
            document.getElementById('btn-des').className = p === 'DES25' ? 'px-6 py-2 rounded-xl text-xs font-black transition-all bg-slate-900 text-white' : 'px-6 py-2 rounded-xl text-xs font-black transition-all text-slate-400';
            refreshAll();
        }

        // --- 4. RENDERERS ---
        function renderDashboard() {
            let totalProfit = 0, totalQty = 0, totalRevenue = 0, totalMargin = 0;
            const key = activePeriod === 'JAN26' ? 'jan' : 'des';

            ALL_MENU.forEach(m => {
                const hpp = calculateHPP(m.recipe);
                const qty = m[key];
                totalProfit += (m.sell - hpp) * qty;
                totalQty += qty;
                totalRevenue += m.sell * qty;
                totalMargin += ((m.sell - hpp) / m.sell) * 100;
            });

            document.getElementById('dash-profit').innerText = "Rp " + Math.round(totalProfit).toLocaleString();
            document.getElementById('dash-qty').innerText = totalQty.toLocaleString() + " Cups";
            document.getElementById('dash-revenue').innerText = "Rp " + totalRevenue.toLocaleString();
            document.getElementById('dash-margin').innerText = (totalMargin / ALL_MENU.length).toFixed(1) + "%";
            document.getElementById('dash-top').innerText = ALL_MENU[0].name;
        }

        function renderMenuList() {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            ALL_MENU.forEach((m, i) => {
                const hpp = calculateHPP(m.recipe);
                const profit = m.sell - hpp;
                container.innerHTML += `
                    <div onclick="showDetail(${i})" class="p-5 bg-slate-50 rounded-2xl border border-slate-100 cursor-pointer hover:bg-white hover:shadow-xl transition-all group">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-black text-slate-800">${m.name}</p>
                                <p class="text-[10px] text-slate-400 font-bold">PROFIT: Rp ${Math.round(profit).toLocaleString()}</p>
                            </div>
                            <i class="fas fa-arrow-right text-slate-200 group-hover:text-orange-500"></i>
                        </div>
                    </div>`;
            });
        }

        function showDetail(idx) {
            const m = ALL_MENU[idx];
            const hpp = calculateHPP(m.recipe);
            const detail = document.getElementById('recipe-detail');
            document.getElementById('recipe-placeholder').classList.add('hidden');
            detail.classList.remove('hidden');

            let rows = Object.entries(m.recipe).map(([ing, qty]) => `
                <div class="flex justify-between py-3 border-b border-slate-100">
                    <span class="text-slate-500 font-medium">${ing}</span>
                    <span class="font-mono text-slate-800">Rp ${Math.round(rawPrices[ing]*qty).toLocaleString()}</span>
                </div>
            `).join('');

            detail.innerHTML = `
                <div class="flex justify-between items-start mb-10">
                    <div>
                        <h4 class="text-4xl font-black italic uppercase">${m.name}</h4>
                        <span class="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">HPP Analysis</span>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-slate-400 font-bold">HARGA JUAL</p>
                        <p class="text-2xl font-black text-slate-900">Rp ${m.sell.toLocaleString()}</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div><h5 class="text-xs font-black mb-4 text-slate-300 uppercase">Komposisi Bahan</h5>${rows}</div>
                    <div class="bg-slate-50 p-8 rounded-[2rem] border border-slate-100 flex flex-col justify-center">
                        <div class="mb-6"><p class="text-[10px] font-bold text-slate-400">TOTAL MODAL (HPP)</p><p class="text-3xl font-black text-red-500">Rp ${Math.round(hpp).toLocaleString()}</p></div>
                        <div><p class="text-[10px] font-bold text-slate-400">LABA BERSIH / CUP</p><p class="text-3xl font-black text-emerald-500">Rp ${Math.round(m.sell-hpp).toLocaleString()}</p></div>
                    </div>
                </div>`;
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            if(grid.innerHTML !== '') return;
            Object.entries(rawPrices).forEach(([name, price]) => {
                grid.innerHTML += `
                    <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100 group transition-all hover:border-orange-200">
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest">${name}</label>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 font-bold">Rp</span>
                            <input type="number" value="${price}" oninput="updatePrice('${name}', this.value)" 
                                class="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-2xl font-black text-sm outline-none focus:ring-2 focus:ring-orange-500 transition-all">
                        </div>
                    </div>`;
            });
        }

        function updatePrice(name, val) {
            rawPrices[name] = parseFloat(val) || 0;
            // Update Dashboard & Menu detail tanpa pindah tab
            renderDashboard();
            if(!document.getElementById('recipe-detail').classList.contains('hidden')) {
                // Refresh detail resep jika sedang terbuka
                const currentMenuName = document.querySelector('#recipe-detail h4').innerText;
                const idx = ALL_MENU.findIndex(m => m.name.toUpperCase() === currentMenuName);
                if(idx !== -1) showDetail(idx);
            }
        }

        function exportData() {
            let csv = "Menu,HPP,Profit,Margin%\n";
            ALL_MENU.forEach(m => {
                const hpp = calculateHPP(m.recipe);
                csv += `${m.name},${Math.round(hpp)},${Math.round(m.sell-hpp)},${((m.sell-hpp)/m.sell*100).toFixed(1)}%\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'Laporan_TuanRumah.csv'; a.click();
        }

        window.onload = refreshAll;
    </script>
</body>
</html>
