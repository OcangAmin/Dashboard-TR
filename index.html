<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Rekapitulasi Penjualan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #007bff; color: white; transition: 0.3s; }
        button:hover { background: #0056b3; }
        canvas { max-width: 100%; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; }
        .status { text-align: center; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>Dashboard Penjualan Menu</h1>
    
    <div class="controls">
        <button onclick="loadData()">ðŸ”„ Muat / Segarkan Data</button>
    </div>

    <p id="loadingStatus" class="status">Klik tombol untuk memproses file CSV...</p>

    <canvas id="salesChart"></canvas>

    <div id="tableContainer"></div>
</div>

<script>
    let myChart = null;
    const csvUrl = 'https://raw.githubusercontent.com/OcangAmin/Dashboard-TR/refs/heads/main/Sales%20Menu%20Recapitulation%20By%20Time%20Report_TNRCPOSADMIN_17715414456883.csv';

    async function loadData() {
        const status = document.getElementById('loadingStatus');
        status.innerText = "Mengambil data dari GitHub...";

        Papa.parse(csvUrl, {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                renderDashboard(results.data);
                status.innerText = "Data berhasil dimuat!";
            },
            error: function(err) {
                status.innerText = "Gagal memuat data: " + err.message;
            }
        });
    }

    function renderDashboard(data) {
        // Membersihkan data kosong
        const cleanData = data.filter(row => row.Menu && row.Total);

        // 1. Logika Grafik (Top 5 Menu)
        const labels = cleanData.map(item => item.Menu).slice(0, 10);
        const values = cleanData.map(item => item.Total).slice(0, 10);

        const ctx = document.getElementById('salesChart').getContext('2d');
        
        // Hancurkan chart lama jika ada agar tidak tumpang tindih
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Total Penjualan (Qty/Value)',
                    data: values,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Top 10 Menu Terlaris' }
                }
            }
        });

        // 2. Logika Tabel
        let tableHtml = '<table><thead><tr>';
        // Ambil header dari kunci objek pertama
        Object.keys(cleanData[0]).forEach(key => {
            tableHtml += `<th>${key}</th>`;
        });
        tableHtml += '</tr></thead><tbody>';

        cleanData.forEach(row => {
            tableHtml += '<tr>';
            Object.values(row).forEach(val => {
                tableHtml += `<td>${val || '-'}</td>`;
            });
            tableHtml += '</tr>';
        });
        tableHtml += '</tbody></table>';

        document.getElementById('tableContainer').innerHTML = tableHtml;
    }
</script>

</body>
</html>
