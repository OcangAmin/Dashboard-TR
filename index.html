<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuan Rumah Coffee | Professional Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-active { @apply bg-orange-500 text-white shadow-lg; }
        .input-focus { @apply focus:ring-2 focus:ring-orange-500 focus:outline-none transition-all; }
        .card-anim { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-anim:hover { transform: translateY(-4px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 md:top-0 md:left-0 md:translate-x-0 md:h-screen md:w-20 bg-slate-900 text-white flex md:flex-col items-center justify-around py-8 z-50 md:rounded-r-3xl w-[95%] md:w-20 rounded-2xl shadow-2xl">
        <div class="hidden md:block mb-10 text-orange-500"><i class="fas fa-crown text-2xl"></i></div>
        <button onclick="switchTab('dashboard')" class="nav-btn p-4 rounded-2xl transition hover:bg-slate-800 text-orange-400" id="btn-dashboard"><i class="fas fa-chart-line text-xl"></i></button>
        <button onclick="switchTab('inventory')" class="nav-btn p-4 rounded-2xl transition hover:bg-slate-800 text-slate-500" id="btn-inventory"><i class="fas fa-boxes-stacked text-xl"></i></button>
        <button onclick="exportData()" class="mt-auto p-4 rounded-2xl transition hover:bg-green-600 text-green-400" title="Download Report"><i class="fas fa-file-export text-xl"></i></button>
    </nav>

    <main class="md:ml-28 p-4 md:p-10 pb-32">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
            <div>
                <h1 class="text-4xl font-black tracking-tighter">DASHBOARD <span class="text-orange-500 italic">TUAN RUMAH</span></h1>
                <p class="text-slate-400 font-medium italic">Manajemen HPP & Bahan Baku Real-Time</p>
            </div>
            <div class="flex gap-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Global Margin</p>
                    <p class="text-2xl font-black text-slate-800" id="global-margin-text">0%</p>
                </div>
            </div>
        </header>

        <section id="tab-dashboard" class="tab-content">
            <div class="flex gap-3 mb-8 overflow-x-auto pb-4">
                <button onclick="filterMenu('All')" class="cat-filter px-6 py-2 rounded-full bg-slate-900 text-white text-xs font-bold shadow-md">All Menu</button>
                <button onclick="filterMenu('Coffee Based')" class="cat-filter px-6 py-2 rounded-full bg-white text-slate-500 text-xs font-bold shadow-sm border">Coffee Based</button>
                <button onclick="filterMenu('Non Coffee')" class="cat-filter px-6 py-2 rounded-full bg-white text-slate-500 text-xs font-bold shadow-sm border">Non Coffee</button>
                <button onclick="filterMenu('Specialty')" class="cat-filter px-6 py-2 rounded-full bg-white text-slate-500 text-xs font-bold shadow-sm border">Specialty</button>
            </div>

            <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
        </section>

        <section id="tab-inventory" class="tab-content hidden">
            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-black italic">Master Harga Bahan Baku</h2>
                    <span class="text-xs bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-bold">Autosave Active</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="inventory-editor">
                    </div>
            </div>
        </section>
    </main>

    <div id="recipe-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl">
            <div class="p-6 border-b bg-slate-50 flex justify-between items-center">
                <h3 id="modal-title" class="text-xl font-black">Recipe Detail</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500"><i class="fas fa-times-circle text-2xl"></i></button>
            </div>
            <div class="p-6">
                <div id="modal-ingredients" class="space-y-4 mb-8"></div>
                <div class="bg-slate-900 text-white p-5 rounded-2xl flex justify-between">
                    <div><p class="text-[10px] text-slate-400 uppercase font-bold">Total HPP</p><p id="modal-hpp" class="text-xl font-black text-orange-400"></p></div>
                    <div class="text-right"><p class="text-[10px] text-slate-400 uppercase font-bold">Profit</p><p id="modal-profit" class="text-xl font-black text-green-400"></p></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATA MASTER (SINKRON)
        let refHarga = {
            "Biji Kopi Diks": 180, "Susu UHT Diamond": 19.5, "Susu Evaporasi": 48,
            "SKM": 36, "Creamer": 85, "Gula Aren": 35, "Syrup Monin": 221,
            "Oatside": 42, "Powder Premium": 95, "Cheese Cream": 130,
            "Peanut Butter": 170, "Biscoff Spread": 200, "Lotus Biskuit": 1500,
            "Hydro Coco": 25, "Sprite": 15, "Yakult": 2500, "Simple Sugar": 15,
            "Teh Ekstrak": 10, "Air Galon": 1, "Packaging Set": 1500
        };

        const masterMenu = [
            { name: "Kopi Susu Ice", cat: "Coffee Based", sell: 22000, recipe: { "SKM": 20, "Creamer": 15, "Susu Evaporasi": 10, "Biji Kopi Diks": 18, "Susu UHT Diamond": 70, "Packaging Set": 1 } },
            { name: "Tuan Rumah Ice", cat: "Coffee Based", sell: 25000, recipe: { "Gula Aren": 25, "Creamer": 25, "Biji Kopi Diks": 18, "Susu UHT Diamond": 100, "Packaging Set": 1 } },
            { name: "Matcha Latte", cat: "Non Coffee", sell: 28000, recipe: { "Powder Premium": 20, "SKM": 15, "Creamer": 10, "Susu UHT Diamond": 110, "Packaging Set": 1 } },
            { name: "Tiramisu Ice", cat: "Coffee Based", sell: 28000, recipe: { "Syrup Monin": 20, "SKM": 10, "Creamer": 15, "Biji Kopi Diks": 18, "Susu UHT Diamond": 100, "Cheese Cream": 20, "Packaging Set": 1 } },
            { name: "Americano Ice", cat: "Specialty", sell: 22000, recipe: { "Biji Kopi Diks": 18, "Air Galon": 150, "Packaging Set": 1 } },
            { name: "Berry Cano", cat: "Coffee Based", sell: 25000, recipe: { "Syrup Monin": 20, "Simple Sugar": 10, "Biji Kopi Diks": 18, "Air Galon": 100, "Packaging Set": 1 } }
            // ... (Lengkapi 42 menu sesuai daftar sebelumnya)
        ];

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('text-orange-400'));
            document.getElementById(`btn-${tabId}`).classList.add('text-orange-400');
        }

        function calculateHPP(recipe) {
            return Object.entries(recipe).reduce((total, [ing, qty]) => total + (refHarga[ing] * qty), 0);
        }

        function updatePrice(ing, newPrice) {
            refHarga[ing] = parseFloat(newPrice) || 0;
            renderAll(); // Re-render semua tab agar sinkron
        }

        function renderAll() {
            renderMenu();
            renderInventory();
            updateGlobalStats();
        }

        function renderMenu(filter = "All") {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            masterMenu.filter(m => filter === "All" || m.cat === filter).forEach(m => {
                const hpp = calculateHPP(m.recipe);
                const margin = ((m.sell - hpp) / m.sell * 100).toFixed(0);
                grid.innerHTML += `
                    <div onclick="openModal('${m.name}')" class="card-anim bg-white rounded-3xl p-5 shadow-sm border border-slate-100 cursor-pointer">
                        <div class="flex justify-between mb-4"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${m.cat}</span><span class="px-3 py-1 bg-orange-50 text-orange-600 rounded-full text-[10px] font-black">${margin}%</span></div>
                        <h4 class="font-black text-slate-800 text-lg mb-1">${m.name}</h4>
                        <div class="flex justify-between items-end mt-4">
                            <div><p class="text-[9px] text-slate-300 font-bold uppercase">Price</p><p class="font-bold text-sm">Rp ${m.sell.toLocaleString()}</p></div>
                            <div class="text-right"><p class="text-[9px] text-slate-300 font-bold uppercase">HPP</p><p class="font-black text-red-500 italic text-sm">Rp ${Math.round(hpp).toLocaleString()}</p></div>
                        </div>
                    </div>`;
            });
        }

        function renderInventory() {
            const editor = document.getElementById('inventory-editor');
            editor.innerHTML = '';
            Object.entries(refHarga).forEach(([name, price]) => {
                editor.innerHTML += `
                    <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 tracking-widest">${name}</label>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs font-bold font-mono">Rp</span>
                            <input type="number" value="${price}" onchange="updatePrice('${name}', this.value)" 
                                class="w-full bg-white pl-10 pr-4 py-3 rounded-xl border border-slate-200 text-sm font-black input-focus">
                        </div>
                    </div>`;
            });
        }

        function updateGlobalStats() {
            const avg = masterMenu.reduce((acc, m) => acc + ((m.sell - calculateHPP(m.recipe)) / m.sell * 100), 0) / masterMenu.length;
            document.getElementById('global-margin-text').innerText = avg.toFixed(1) + '%';
        }

        function openModal(name) {
            const m = masterMenu.find(x => x.name === name);
            const hpp = calculateHPP(m.recipe);
            document.getElementById('modal-title').innerText = m.name;
            document.getElementById('modal-hpp').innerText = `Rp ${Math.round(hpp).toLocaleString()}`;
            document.getElementById('modal-profit').innerText = `Rp ${Math.round(m.sell - hpp).toLocaleString()}`;
            const list = document.getElementById('modal-ingredients');
            list.innerHTML = Object.entries(m.recipe).map(([ing, qty]) => `
                <div class="flex justify-between text-sm border-b pb-2">
                    <span class="text-slate-600 font-medium">${ing} (${qty})</span>
                    <span class="font-mono text-slate-400">Rp ${Math.round(refHarga[ing]*qty).toLocaleString()}</span>
                </div>`).join('');
            document.getElementById('recipe-modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('recipe-modal').classList.add('hidden'); }

        function exportData() {
            let csv = "Nama Menu,Kategori,Harga Jual,HPP,Profit,Margin %\n";
            masterMenu.forEach(m => {
                const hpp = Math.round(calculateHPP(m.recipe));
                const profit = m.sell - hpp;
                const margin = ((profit / m.sell) * 100).toFixed(2);
                csv += `${m.name},${m.cat},${m.sell},${hpp},${profit},${margin}%\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'Laporan_HPP_TuanRumah.csv');
            a.click();
        }

        window.onload = renderAll;
    </script>
</body>
</html>
